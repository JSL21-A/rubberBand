<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>マイアクティビティ</title>
<style>
body {
	font-family: 'Noto Sans JP', sans-serif;
	background: #f8f9fa;
	margin: 0;
	padding: 2rem;
	color: #222;
}

.tabs {
	display: flex;
	gap: 1.5rem;
	border-bottom: 2px solid #ddd;
	margin-bottom: 1rem;
}

.tab {
	font-weight: bold;
	padding-bottom: 0.5rem;
	cursor: pointer;
	color: #333;
	border-bottom: 3px solid transparent;
	text-decoration: none;
}

.tab.active {
	border-color: #000;
	text-decoration: none;
}

table {
	width: 100%;
	background: white;
	border-radius: 6px;
	overflow: hidden;
	box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
	border-collapse: collapse;
	margin-bottom: 1rem;
}

th, td {
	text-align: left;
	padding: 0.75rem 1rem;
	border-bottom: 1px solid #eee;
}

td a {
	color: #007bff;
	text-decoration: none;
}

td a:hover {
	text-decoration: none;
}

.controls {
	display: flex;
	align-items: center;
	gap: 1rem;
	margin-top: 1rem;
	justify-content: center;
}

input[type="text"] {
	padding: 0.5rem;
	border: 1px solid #ccc;
	border-radius: 4px;
	width: 200px;
}

button {
	padding: 0.5rem 1rem;
	background: #000;
	color: white;
	border: none;
	border-radius: 4px;
	cursor: pointer;
}

button:hover {
	background: #333;
}

.pagination {
	text-align: center;
	margin-top: 1.5rem;
}

.checkbox {
	text-align: center;
}

.container {
	max-width: 720px;
	margin: 0 auto;
}

.active-page {
	font-weight: bold;
	text-decoration: underline;
}
</style>
</head>
<body>
	<div class="container">
		<h2>マイアクティビティ</h2>

		<div class="tabs">
			<a class="tab"
				th:classappend="${mode} == 'comments' ? ' active' : ''"
				href="/mypage/activity/comments">コメント</a> <a class="tab"
				th:classappend="${mode} == 'posts' ? ' active' : ''"
				href="/mypage/activity/posts">投稿</a>
			<!--  <a class="tab" th:classappend="${mode} == 'scraps' ? ' active' : ''" href="/mypage/activity">スクラップ</a>
	<a class="tab" th:classappend="${mode} == 'applies' ? ' active' : ''" href="/mypage/activity">バンド応募履歴</a>-->
		</div>

		<!-- 投稿 리스트 -->
		<div th:if="${mode} == 'posts'">
			<form method="post" action="/mypage/deletePosts"
				th:action="@{/mypage/deletePosts}">
				<input type="hidden" th:name="${_csrf.parameterName}"
					th:value="${_csrf.token}" />

				<table>
					<thead>
						<tr>
							<th class="checkbox"><input type="checkbox"
								id="checkAllPosts" onclick="toggleAllPosts(this)"></th>
							<th>タイトル</th>
							<th>投稿日</th>
						</tr>
					</thead>
					<tbody>
						<tr
							th:if="${postContentList == null or #lists.isEmpty(postContentList)}">
							<td colspan="3" style="text-align: center;">投稿された記事はありません。</td>
						</tr>
						<tr th:each="post : ${postContentList}">
							<td class="checkbox"><input type="checkbox" name="postIds"
								th:value="${post.post_id}" /></td>
							<td><a th:href="@{/user/view(post=${post.post_id})}"
								th:text="${post.post_title} ?: 'タイトルなし'"></a></td>
							<!--  <td
								th:text="${#dates.format(post.createdAt, 'yyyy-MM-dd')}"></td>-->
						</tr>
					</tbody>
				</table>

				<div class="controls">
					<button type="submit">削除</button>
					<input type="text" name="keyword" placeholder="タイトルで検索">
					<button type="submit" formaction="/post/search">検索</button>
				</div>
			</form>
		</div>


		<!-- コメント 리스트 + 삭제 + 검색 -->
		<div th:if="${mode} == 'comments'">
			<form method="post" action="/mypage/deleteComments"
				th:action="@{/mypage/deleteComments}">
				<input type="hidden" th:name="${_csrf.parameterName}"
					th:value="${_csrf.token}" />
				<table>
					<thead>
						<tr>
							<th class="checkbox"><input type="checkbox" id="checkAll"
								onclick="toggleAll(this)"></th>
							<th>コメント</th>
							<th>投稿日</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="comment : ${commentContentList}">
							<td class="checkbox"><input type="checkbox"
								name="commentIds" th:value="${comment.commentId}"></td>
							<td><a th:href="@{/user/view(post=${comment.postId})}"
								th:text="${comment.commentContent}"></a></td>
							<td
								th:text="${#dates.format(comment.commentCreatedAt, 'yyyy-MM-dd')}"></td>
						</tr>
					</tbody>
				</table>
				<div class="controls">
					<button type="submit">削除</button>
					<input type="text" name="keyword" placeholder="タイトルで検索">
					<button type="submit" formaction="/comment/search">検索</button>
				</div>
			</form>
		</div>

		<!-- コメント 페이지네이션 -->
		<!-- 이전 페이지 버튼 -->
		<a th:if="${commentList != null and commentList.hasPrevious()}"
			th:href="@{/mypage/activity(page=${commentList.number - 1})}">&laquo;
			前</a>

		<!-- 페이지 번호 
		<span th:if="${commentList != null}"
			th:each="pageNum : ${#.sequence(0, commentList.totalPages - 1)}">
			<a th:href="@{/mypage/activity(page=${pageNum})}"
			th:text="${pageNum + 1}"
			th:classappend="${pageNum == commentList.number} ? ' active-page' : ''">
		</a>
		</span>

		<!-- 다음 페이지 버튼 -->
		<!--<a th:if="${commentList != null and commentList.hasNext()}"
			th:href="@{/mypage/activity(page=${commentList.number + 1})}">次
			&raquo;</a>-->

	</div>

	<script>
	//댓글 체크박스
    function toggleAll(source) {
      const checkboxes = document.querySelectorAll('input[name="commentIds"]');
      checkboxes.forEach(cb => cb.checked = source.checked);
    }
  </script>

	<script>
  // 게시글 체크박스
  function toggleAllPosts(source) {
    const checkboxes = document.querySelectorAll('input[name="postIds"]');
    checkboxes.forEach(cb => cb.checked = source.checked);
  }
</script>

</body>
</html>