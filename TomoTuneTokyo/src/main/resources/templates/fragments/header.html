<div th:fragment="header">
	<div class="top_navigation">
		<header class="header">
			<div class="scrolling-banner">
				<p>âœ¨ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†ä¸­ï¼ğŸ¤ ãƒœãƒ¼ã‚«ãƒ«ã€ãƒ‰ãƒ©ãƒãƒ¼ã€ãƒ©ãƒƒãƒ‘ãƒ¼ å¤§æ­“è¿ï¼ğŸ§ ä»Šã™ãå¿œå‹Ÿã—ã¦ã¿ã‚ˆã†ï¼</p>
			</div>

			<div class="header-container">
				<div class="header-item left">
					<a href="/"> <img src="/images/logo.png" class="header-icon home-icon" alt="Home Icon">
					</a>
				</div>
				<div class="header-item center">
					<h1>Tomo Tune Tokyo</h1>
				</div>
				<div class="header-item right">
					<div id="hamburgerBtn" class="hamburger-icon">
						<img th:src="@{/images/memberIcon.png}" th:data-hover-src="@{/images/memberIcon_hover.png}"
							class="header-icon hamburger-icon" alt="Hamburger Icon">
						<div id="slideMenu" th:fragment="slideMenu" class="slide-menu">
							<script th:inline="javascript">
								/*<![CDATA[*/
								window.currentUser = /*[[${currentUserId}]]*/'anonymous';
								/*]]>*/
							</script>
							<button class="close-btn" aria-label="é–‰ã˜ã‚‹">&times;</button>
							<form id="loginForm" th:action="@{/user/login}" method="post" class="login-form"
								sec:authorize="!isAuthenticated()">

								<h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
								<div class="form-group">
									<input type="text" name="username" placeholder="ID" required />
								</div>
								<div class="form-group">
									<input type="password" name="password" placeholder="PASSWORD" required />
								</div>
								<button id="login" type="button" class="btn-login">ãƒ­ã‚°ã‚¤ãƒ³</button>
								<div class="login-actions">
									<a href="#" class="btn-link register-link">ä¼šå“¡ç™»éŒ²</a> <a href="/user/forgot"
										id="forgotLink" class="btn-link">IDï¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã®æ–¹</a>
								</div>
							</form>
							<div id="mainPane" style="display: block;">
								<div class="welcome" style="display: none">
									<!-- ì•Œë¦¼ ì•„ì´ì½˜ -->
									<div class="notification" title="ì•Œë¦¼">
										<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26"
											viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2"
											stroke-linecap="round" stroke-linejoin="round">
											<path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
											<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
										</svg>
										<span class="notification-badge" style="display: none">0</span>
									</div>
									<!-- ì‚¬ì´ë“œë°” ë¯¸ë‹ˆ í”„ë¡œí•„ -->
									<div class="sidebar-profile" th:if="${currentUser != null}">
										<!-- í”„ë¡œí•„ ì´ë¯¸ì§€ í´ë¦­ì‹œ í”„ë¡œí•„ í¸ì§‘í™”ë©´ìœ¼ë¡œ ì´ë™ -->
										<img th:src="${currentUser.user_img} != null 
									           ? @{${'/images' + currentUser.user_img}} 
									           : @{/images/defaultIcon.png}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="sidebar-avatar" />
										<div class="sidebar-nickname" th:text="${currentUser.nickname}"></div>
										<div class="sidebar-id" th:text="'@' + ${currentUser.username}"></div>
										<div class="sidebar-email" th:text="${currentUser.email}"></div>
									</div>
									<!-- ì‚¬ì´ë“œë°” ë©”ë‰´ -->
									<nav>
										<a href="#" onclick="openProfilePopup(); return false;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</a>
										<a href="#"
											onclick="window.open('/mypage/account', 'AccountSettings', 'width=600,height=800,menubar=no,toolbar=no,location=no,status=no'); return false;"
											class="open-account-btn">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</a> <a href="/activity">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</a>
										<a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
									</nav>

								</div>
								<div class="welcome" sec:authorize="isAuthenticated()">
									<!-- ì•Œë¦¼ ì•„ì´ì½˜ -->
									<div class="notification" title="ì•Œë¦¼">
										<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26"
											viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2"
											stroke-linecap="round" stroke-linejoin="round">
											<path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
											<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
										</svg>
										<span class="notification-badge" style="display: none">0</span>
									</div>
									<!-- ì‚¬ì´ë“œë°” ë¯¸ë‹ˆ í”„ë¡œí•„ -->
									<div class="sidebar-profile" th:if="${currentUser != null}">
										<!-- í”„ë¡œí•„ ì´ë¯¸ì§€ í´ë¦­ì‹œ í”„ë¡œí•„ í¸ì§‘í™”ë©´ìœ¼ë¡œ ì´ë™ -->
										<img th:src="${currentUser.user_img} != null 
									           ? @{${'/images' + currentUser.user_img}} 
									           : @{/images/defaultIcon.png}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="sidebar-avatar" />
										<div class="sidebar-nickname" th:text="${currentUser.nickname}"></div>
										<div class="sidebar-id" th:text="'@' + ${currentUser.username}"></div>
										<div class="sidebar-email" th:text="${currentUser.email}"></div>
									</div>
									<!-- ì‚¬ì´ë“œë°” ë©”ë‰´ -->
									<nav>
										<a href="#" onclick="openProfilePopup(); return false;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</a>

										<a href="#" onclick="openMyPage()" class="open-account-btn">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</a> <a
											href="/mypage/activity">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</a>
										<a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
										<a href="/admin/"
											th:if="${#authorization.expression('hasRole(''A'')')}">ç®¡ç†è€…ãƒšãƒ¼ã‚¸</a>
									</nav>

								</div>
							</div>

							<div id="notificationPane" style="display: none; padding: 1rem;">
								<h2>é€šçŸ¥</h2>
								<ul id="notificationList" style="list-style: none; padding: 0;">
									<!-- JS ë¡œ ì—¬ê¸°ì— <li>ìƒˆ ëŒ“ê¸€ì´ ë‹¬ë ¸ìŠµë‹ˆë‹¤.</li> ê°™ì€ ì•„ì´í…œì„ ì¶”ê°€ -->
								</ul>
								<button class="notify-btn" style="margin-top: 1rem;">â†
									æˆ»ã‚‹</button>
							</div>

							<form id="registerForm" class="register-form" th:action="@{/user/register}" method="post"
								style="display:none">
								<h2>ä¼šå“¡ç™»éŒ²</h2>
								<div class="form-group">
									<input type="text" name="username" id="regUsername" placeholder="ãƒ­ã‚°ã‚¤ãƒ³ID" required
										minlength="4" maxlength="20" />
									<div id="usernameMsg" class="validation-msg"></div>
								</div>
								<div class="form-group">
									<input type="password" id="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required />
								</div>
								<div class="form-group">
									<input type="password" id="passwordConfirm" name="passwordConfirm"
										placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª" required />
									<div id="pwMatchMsg" class="validation-msg"></div>
								</div>
								<div class="form-group nickname-group">
									<input type="text" id="nickname" name="nickname" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ " required
										minlength="2" maxlength="8" />
									<div id="nickMsg" class="validation-msg"></div>
								</div>
								<div class="form-group email-group">
									<input type="email" id="email" name="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required />
									<button type="button" id="sendEmailCode">èªè¨¼ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
									<div id="emailMsg" class="validation-msg"></div>
								</div>
								<div class="form-group email-group" id="emailCodeGroup" style="display: none;">
									<input type="text" id="emailCode" placeholder="èªè¨¼ç•ªå·ã‚’å…¥åŠ›" />
									<button type="button" id="verifyEmailCode">èªè¨¼ã™ã‚‹</button>
									<div id="codeMsg" class="validation-msg"></div>
								</div>
								<button type="button" id="registerBtn" class="btn-login">ç™»éŒ²ã™ã‚‹</button>

								<div id="registerMsg" class="validation-msg"></div>
								<div class="login-actions">
									<a href="#" class="btn-link back-to-login">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</a>
								</div>
							</form>
							<form class="forgot-form" style="display: none">
								<h2>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åˆæœŸåŒ–</h2>
								<div class="form-group">
									<input type="text" id="fpUsername" placeholder="ãƒ­ã‚°ã‚¤ãƒ³ID" required />
									<div id="fpUsernameMsg" class="validation-msg"></div>
								</div>
								<button type="button" id="fpNextBtn" class="btn-login">æ¬¡ã¸</button>
								<div class="login-actions">
									<a href="#" class="btn-link back-to-login">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</a>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>

			<!-- ë„¤ë¹„ê²Œì´ì…˜ (ì‚­ì œ)-->

		</header>

		<script>
			//íŒì—…ì°½ í¬ê¸° ì¡°ì • -ê°•ì‹œ-
			document.addEventListener("DOMContentLoaded", function () {
				const loginForm = document.getElementById("loginForm");

				loginForm.addEventListener("submit", function (e) {
					// 1) í¼ ìš”ì†Œ ì „ì²´ê°€ ìœ íš¨í•œì§€ ê²€ì‚¬(checkValidity)
					if (!loginForm.checkValidity()) {
						// 2) ìœ íš¨í•˜ì§€ ì•Šì„ ë•Œ: ì œì¶œ ë§‰ê³ (validation ë©”ì‹œì§€ í‘œì‹œ)
						e.preventDefault();
						loginForm.reportValidity(); // ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ invalid ë©”ì‹œì§€ë¥¼ ë„ì›Œì¤Œ
					}
					// ìœ íš¨í•˜ë©´ ë³„ë„ ì²˜ë¦¬ ì—†ì´ í¼ì´ ì„œë²„ë¡œ ì œì¶œë¨
				});
			});
		</script>

		<!-- <script>
			//íŒì—…ì°½ í¬ê¸° ì¡°ì • -ê°•ì‹œ-
			function openProfilePopup() {
				window.open('/mypage/profileEdit', 'ProfileEditPopup',
					'width=420,height=580,resizable=no,scrollbars=no');
			}
		</script> -->
		<script>
			function openProfilePopup() {
				const width = 420;
				const height = 580;
				// ê°€ë¡œ í™”ë©´ ê°€ìš´ë° ì •ë ¬
				const left = Math.round((window.screen.width - width) / 2);
				// ì„¸ë¡œ í™”ë©´ì—ì„œ 200px ì•„ë˜ì— ìœ„ì¹˜
				const top = 200;
				const opts = `width=${width},height=${height},top=${top},left=${left},resizable=no,scrollbars=no`;
				window.open('/mypage/profileEdit', 'ProfileEditPopup', opts);
			}

			function openMyPage() {
				console.log("onit");
				// íŒì—… ê°€ë¡œ/ì„¸ë¡œ í¬ê¸°
				const w = 600, h = 800;
				// í™”ë©´ ê°€ë¡œ ì¤‘ì•™ì— ë„ìš°ê¸°
				const left = Math.round((screen.width - w) / 2);
				// í™”ë©´ ìœ„ì—ì„œ 200px ì•„ë˜
				const top = 200;
				window.open(
					"/mypage/account",
					"AccountSettings",
					"width=" + w +
					",height=" + h +
					",left=" + left +
					",top=" + top +
					",menubar=no,toolbar=no,location=no,status=no"
				);
			}

			document.addEventListener("click", function (event) {
				const btn = event.target.closest(".open-account-btn");
				if (!btn) return;
				event.preventDefault();
				console.log("onit");
				// íŒì—… ê°€ë¡œ/ì„¸ë¡œ í¬ê¸°
				const w = 600, h = 800;
				// í™”ë©´ ê°€ë¡œ ì¤‘ì•™ì— ë„ìš°ê¸°
				const left = Math.round((screen.width - w) / 2);
				// í™”ë©´ ìœ„ì—ì„œ 200px ì•„ë˜
				const top = 200;
				window.open(
					"/mypage/account",
					"AccountSettings",
					"width=" + w +
					",height=" + h +
					",left=" + left +
					",top=" + top +
					",menubar=no,toolbar=no,location=no,status=no"
				);
			});
		</script>
	</div>
</div>