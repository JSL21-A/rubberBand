<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultrag.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<head>
	<meta charset="UTF-8">
	<meta name="_csrf" th:content="${_csrf.token}" />
	<meta name="_csrf_parameter" th:content="${_csrf.parameterName}" />
	<title>ë°´ë“œ ìƒì„¸ì •ë³´</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link rel="stylesheet" href="/css/band-profile-style.css">
</head>

<body th:attr="data-is-leader=${isLeader}">
	<div layout:fragment="content">
		<!-- ì „ì²´ í¼ -->
		<div class="band-profile-outer-form">
			<span id="band-id" th:text="${band.band_id}" style="display:none;"></span>

			<!-- ì»¤ë²„ ì´ë¯¸ì§€ -->
			<div class="cover-image">
				<img th:src="@{'/images/uploads/bands/' + ${band.band_cover_img}}" alt="ì»¤ë²„ ì´ë¯¸ì§€">
				
				<!-- ì´ˆëŒ€ ì•Œë¦¼ ê³ ì • íŒì—… (ì˜¤ë¥¸ìª½ ìƒë‹¨) -->
				
				<div id="member-invite-popup" class="member-invite-fixed" th:if="${currentUserVo != null  && currentUserVo.status == 'I'}" style="display: none;">
				  <button class="invite-close-btn">Ã—</button>
				  <h4 class="popup-title">ãƒãƒ³ãƒ‰æ‹›å¾…ã®ãŠçŸ¥ã‚‰ã›</h4>
				  <p class="popup-message">
				    <strong>ãƒãƒ³ãƒ‰å</strong>ã‹ã‚‰ ãƒãƒ³ãƒ‰ã‹ã‚‰ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…ã‚’å—ã‘ã¾ã—ãŸã€‚<span class="register-question">ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ</span>
				  </p>
				  <div class="popup-buttons">
				    <button id = "btn-accept" class="btn-accept">å—è«¾</button>
				    <button id = "btn-decline" class="btn-decline">æ‹’çµ¶</button>
				  </div>
				</div>

			</div>

			<div class="profile-header">
				<!-- í”„ë¡œí•„ ì¸ë„¤ì¼ -->
				<div class="profile-thumbnail">
					<img th:src="@{'/images/uploads/bands/' + ${band.band_profile_img}}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
				</div>

				<!-- í”„ë¡œí•„ ì •ë³´ -->
				<div class="profile-info">
					<h2 class="band-name" th:text="${band.band_name}">Tomo Groove</h2>
					<p class="band-leader-comment" th:text="${band.leader_comment}">ë¦¬ë” ì½”ë©˜íŠ¸</p>
				<p id="leader-email" class="band-email" th:text="${leaderEmail}">ë¦¬ë” ì´ë©”ì¼</p>
					<a id="youtube-link" th:href="${band.youtube_link}" class="external-link" target="_blank">ãƒ¦ãƒ¼ãƒãƒ¥ãƒ¼ãƒ–ãƒãƒ£ãƒ³ãƒãƒ«</a>
					<a id="instagram-link" th:href="${band.instagram_link}" class="external-link" target="_blank"
						style="padding-left: 10px;">ã‚¤ãƒ³ã‚¹ã‚¿</a>
				</div>

				<!-- ìˆ˜ì •/ì±„íŒ… ë²„íŠ¼ -->
				<div class="band-actions">
					<button class="btn-edit" id="edit-toggle-btn" type="button" th:if="${isLeader}">ç·¨é›†ã™ã‚‹</button>
					<button id="btn-chat" class="btn-chat" th:if="${currentUserId != leader.user_id}" th:attr="data-user-id=${leader.user_id}">ãƒãƒ£ãƒƒãƒˆã™ã‚‹</button> 
				</div>
			</div>


			<!-- ë©”ì¸ ì½˜í…ì¸ : ì‚¬ì´ë“œë°”ì™€ ì½˜í…ì¸ ë¥¼ ê°™ì€ wrapper ë‚´ë¶€ì— ë„£ìŒ -->
			<div class="band-content-wrapper">
				<!-- í”„ë¡œí•„ ì•„ë˜ ì„¸ë¡œ ë©”ë‰´ -->
				<nav class="band-sidebar band-sidebar-floating">
					<button class="band-tab-btn active" data-target="section-intro">ãƒãƒ³ãƒ‰ç´¹ä»‹</button>
					<button class="band-tab-btn" data-target="section-members">ãƒãƒ³ãƒ‰ãƒ¡ãƒ³ãƒãƒ¼</button>
					<button class="band-tab-btn" data-target="section-gallery">æ´»å‹•å†™çœŸ</button>
					<button class="band-tab-btn" data-target="section-records">æ´»å‹•è¨˜éŒ²</button>
				</nav>

				<div class="band-content">
					<!-- ì†Œê°œ -->
					<section class="band-section active" id="section-intro">
						<h3>ãƒãƒ³ãƒ‰ç´¹ä»‹</h3>
						<ul class="intro-list">
							<li>
							  <strong>çµæˆæ—¥ : </strong>
							  <span class="formation-date" th:text="${#temporals.format(band.formation_date, 'yyyy-MM-dd')}">2022-05-01</span>
							</li>
							<li>
							  <strong>ã‚¸ãƒ£ãƒ³ãƒ« : </strong>
							  <span th:each="tag, stat : ${tags}"
							        th:if="${tag.tag_type == 'genre' or tag.tag_type == 'position' or tag.tag_type == 'gender' or tag.tag_type == 'age'}"
							        th:text="${tag.tag_value + (stat.last ? '' : ', ')}"
							        class="tag-item">
							  </span>
							</li>
							<!-- ì¥ë¥´ íƒœê·¸ ì„ íƒ íŒì—… êµ¬ì¡° -->
							<div id="genre-popup" class="keyword-popup" style="display: none;">
								<button id="genre-popup-close" class="popup-close">Ã—</button>
								<div class="keyword-box">
									<div class="keyword-row">
										<div class="keyword-category">ã‚¸ãƒ£ãƒ³ãƒ«</div>
										<div class="keyword-tags">
											<span class="tag">ãƒ­ãƒƒã‚¯</span>
											<span class="tag">ãƒãƒƒãƒ—</span>
											<span class="tag">ã‚¸ãƒ£ã‚º</span>
											<span class="tag">ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—</span>
											<span class="tag">ã‚¯ãƒ©ã‚·ãƒƒã‚¯</span>
											<span class="tag">EDM</span>
											<span class="tag">ãã®ä»–</span>
										</div>
									</div>
									<div class="keyword-row">
										<div class="keyword-category">ãƒã‚¸ã‚·ãƒ§ãƒ³</div>
										<div class="keyword-tags">
											<span class="tag">Voï¼ˆãƒœãƒ¼ã‚«ãƒ«)</span>
											<span class="tag">Gtï¼ˆã‚®ã‚¿ãƒ¼ï¼‰</span>
											<span class="tag">Baï¼ˆãƒ™ãƒ¼ã‚¹)</span>
											<span class="tag">Drï¼ˆãƒ‰ãƒ©ãƒ </span>
											<span class="tag">Kbï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰)</span>
											<span class="tag">ãã®ä»–</span>
										</div>
									</div>
									<div class="keyword-row">
										<div class="keyword-category">æ€§åˆ¥</div>
										<div class="keyword-tags">
											<span class="tag">ç”·æ€§ãƒãƒ³ãƒ‰</span>
											<span class="tag">å¥³æ€§ãƒãƒ³ãƒ‰</span>
											<span class="tag">æ··æˆãƒãƒ³ãƒ‰</span>
										</div>
									</div>
									<div class="keyword-row">
										<div class="keyword-category">å¹´é½¢ä»£</div>
										<div class="keyword-tags">
											<span class="tag">10ä»£</span>
											<span class="tag">20ä»£</span>
											<span class="tag">30ä»£</span>
											<span class="tag">40ä»£</span>
											<span class="tag">50ä»£ä»¥ä¸Š</span>
										</div>
									</div>
								</div>
							</div>
							<li>
							  <strong>æ´»å‹•åœ°åŸŸ : </strong>
							  <span class="band-region" th:text="${band.region}">æ±äº¬</span>
							</li>
							<li>
							  <strong>ãƒãƒ³ãƒ‰ç´¹ä»‹ : </strong>
							  <span class="band-one-liner" th:text="${band.band_intro}"></span>
							</li>
						</ul>
					</section>

					<!-- ë©¤ë²„ -->
					<section class="band-section" id="section-members">
					  <h3>ãƒãƒ³ãƒ‰ãƒ¡ãƒ³ãƒãƒ¼</h3>
					  <!-- ë¦¬ë” ë©¤ë²„ ì¹´ë“œ ì „ì²´ -->
					  <div class="member-container leader-only">
					    <div class="member-card"
					         th:attr="data-member-id=${leader.band_member_id},
					                  data-stage-name=${leader.stage_name},
					                  data-member-position=${leader.member_position},
					                  data-member-mbti=${leader.member_mbti},
					                  data-favorite-band=${leader.favorite_band},
					                  data-member-motto=${leader.member_motto},
									  data-member-type='leader'">
					      <!-- ë¦¬ë” ì´ë¯¸ì§€: ê°’ ìˆìœ¼ë©´ ì—…ë¡œë“œ, ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ -->
					      <img th:src="@{${leader != null and leader.user_img != null and !#strings.isEmpty(leader.user_img) 
					        ? '/images' + leader.user_img 
					        : '/images/defaultIcon.png'}}" 
					        alt="ë¦¬ë”" class="member-img"
					        style="width:60px; height:60px; border-radius:50%; object-fit:cover;">

					      <!-- ì´ë¦„ -->
					      <div class="member-name" th:text="'ãƒªãƒ¼ãƒ€ãƒ¼ Â· ' + ${leader.stage_name}"></div>

					      <!-- JSì—ì„œ ë‚´ìš© ì‚½ì…í•  ë¹ˆ íŒì—… -->
					      <div class="member-popup"></div>
					    </div>
					  </div>

					  <!-- ì¼ë°˜ ë©¤ë²„ ëª©ë¡ -->
					  <div class="member-container">
					    <div class="member-card"
					         th:each="member : ${members}"
					         th:if="${member.member_type.name() == 'member'}"
					         th:attr="data-member-id=${member.band_member_id},
					                  data-stage-name=${member.stage_name},
					                  data-member-position=${member.member_position},
					                  data-member-mbti=${member.member_mbti},
					                  data-favorite-band=${member.favorite_band},
					                  data-member-motto=${member.member_motto}">
					      <!-- í”„ë¡œí•„ ì´ë¯¸ì§€: user_img ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ -->
					      <img th:src="@{${member.user_img != null and !#strings.isEmpty(member.user_img) 
					        ? '/images' + member.user_img 
					        : '/images/member1.png'}}" 
					        class="member-img" alt="ë©¤ë²„ ì´ë¯¸ì§€"
					        style="width:60px; height:60px; border-radius:50%; object-fit:cover;">

					      <!-- ì´ë¦„ = í¬ì§€ì…˜ -->
					      <div class="member-name" th:text="'ãƒ¡ãƒ³ãƒãƒ¼ Â· ' + ${member.stage_name}"></div>

					      <!-- JSì—ì„œ ë‚´ìš© ì‚½ì…í•  ë¹ˆ íŒì—… -->
					      <div class="member-popup"></div>
					    </div>
					  </div>
					</section>

					<!-- í™œë™ ì‚¬ì§„ ì„¹ì…˜ -->
					<section class="band-section" id="section-gallery">
						<h3>æ´»å‹•å†™çœŸ</h3>
						<div class="gallery-wrapper">
							<!-- ğŸ“Œ í™œë™ ì‚¬ì§„ ì—†ì„ ë•Œ ë©”ì‹œì§€ -->
							<div th:if="${#lists.isEmpty(galleryList)}">
								<p style="padding: 40px; text-align: center; color: #888;">ç™»éŒ²ã•ã‚ŒãŸæ´»å‹•å†™çœŸã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
							</div>

							<!-- â—€ ì™¼ìª½ í™”ì‚´í‘œ -->
							<button class="gallery-arrow gallery-prev" th:if="${not #lists.isEmpty(galleryList)}">â—€</button>

							<!-- í™œë™ì‚¬ì§„ ìŠ¬ë¼ì´ë“œ ë°˜ë³µ -->
							<div th:each="photo, stat : ${galleryList}" th:if="${photo != null}" class="media-slide"
								th:classappend="${stat.index == 0} ? ' active'" th:attr="
	        data-title=${#strings.defaultString(photo.activityTitle, '')},
	        data-desc=${#strings.defaultString(photo.activityContent, '')},
	        data-photo-id=${photo.activityPhotoId},
	        data-youtube=${#strings.defaultString(photo.activityYoutubeUrl, '')}">

								<div class="media-row">

									<!-- ì¸ë„¤ì¼ -->
									<div class="gallery-grid activity-thumb"
										th:attr="data-title=${photo.activityTitle}, data-desc=${photo.activityContent}">
										<img th:src="@{'/images/uploads/bands/' + ${photo.imageUrl}}">
									</div>
									<span class="photo-id" th:text="${photo.activityPhotoId}"
										style="display: none;"></span>

									<!-- ìœ íŠœë¸Œ ì˜ìƒ -->
									<div class="video-wrapper"
									     th:if="${photo.activityYoutubeUrl != null and #strings.contains(photo.activityYoutubeUrl, 'v=')}">
										 <iframe
										   th:if="${photo.activityYoutubeUrl != null}"
										   th:src="${#strings.contains(photo.activityYoutubeUrl, 'v=') 
										               ? 'https://www.youtube.com/embed/' + #strings.substringAfter(photo.activityYoutubeUrl, 'v=') 
										               : (#strings.contains(photo.activityYoutubeUrl, 'youtu.be/') 
										                   ? 'https://www.youtube.com/embed/' + #strings.substringAfter(photo.activityYoutubeUrl, 'youtu.be/') 
										                   : 'https://www.youtube.com/embed/' + #strings.substringAfter(photo.activityYoutubeUrl, 'embed/'))}"
										   width="560" height="315"
										   frameborder="0"
										   allowfullscreen>
										 </iframe>
									  <p th:text="'src íŒŒì‹± í™•ì¸: https://www.youtube.com/embed/' + ${#strings.substringBefore(#strings.substringAfter(photo.activityYoutubeUrl, 'v='), '&')}"></p>
									</div>
								</div>
							</div>

							<!-- â–¶ ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ -->
							<button class="gallery-arrow gallery-next" th:if="${not #lists.isEmpty(galleryList)}">â–¶</button>
						</div>

						<!-- í•˜ë‹¨ ë„íŠ¸ -->
						<div class="gallery-dots" th:if="${not #lists.isEmpty(galleryList)}">
							<div th:each="photo, stat : ${galleryList}" class="gallery-dot"
								th:classappend="${stat.index == 0} ? ' active'">
							</div>
						</div>

						<!-- í™œë™ì‚¬ì§„ ì„¤ëª… íŒì—… -->
						<div id="activity-popup" class="review-popup" style="display: none;">
							<button class="popup-close">Ã—</button>
							<div class="review-popup-content">
								<h4 class="activity-popup-title">æ´»å‹•å</h4>
								<p class="activity-popup-desc">èª¬æ˜</p>
							</div>
						</div>
					</section>

					<!-- í™œë™ ê¸°ë¡ -->
					<section class="band-section" id="section-records">
						<h3>æ´»å‹•è¨˜éŒ²</h3>
						<div class="gallery-wrapper">
							<!-- â—€ ì™¼ìª½ í™”ì‚´í‘œ -->
							<button class="gallery-arrow gallery-prev">â—€</button>

							<!-- ğŸ“Œ í™œë™ ê¸°ë¡ ì—†ì„ ë•Œ ë©”ì‹œì§€ -->
							<div th:if="${#lists.isEmpty(recordList)}">
								<p style="padding: 40px; text-align: center; color: #888;">ç™»éŒ²ã•ã‚ŒãŸæ´»å‹•è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
							</div>

							<!-- í™œë™ê¸°ë¡ ìŠ¬ë¼ì´ë“œ ë¬¶ìŒ: 4ê°œì”© -->
							<div th:each="slide, stat : ${recordSlides}" class="media-slide"
								th:classappend="${stat.index == 0} ? ' active'">
								<div class="media-row two-columns">
									<!-- ìŠ¬ë¼ì´ë“œ ë‚´ ìµœëŒ€ 4ê°œ ë°˜ë³µ -->
									<div th:each="record : ${slide}" class="column-left">
										<div class="record-card">
											<div class="record-date">
												<span th:text="${record.formattedDate}">ï¼•æœˆ</span><br>
												<strong th:text="${record.formattedDay}">21</strong>
											</div>
											<div class="record-info">
												<span class="record-id" th:text="${record.recordId}" style="display:none;"></span>
												<div class="record-title" th:text="${record.recordTitle}">å…¬æ¼”ã®ã‚¿ã‚¤ãƒˆãƒ«</div>
												<div class="record-status" th:text="${record.recordStatus}">äºˆå®š</div>
												<div class="record-location" th:text="${record.recordLocation}">å ´æ‰€</div>
												<div class="record-meta">
													ğŸ•’ <span th:text="${record.recordTime}">æ™‚é–“</span> &nbsp;
													ğŸ‘¥ <span th:text="${record.participantCount} + 'å'">0å</span>
												</div>
											</div>
											<div class="record-image">
												<img th:src="@{'/images/uploads/bands/' + ${record.recordImageUrl}}"
													alt="ì¸ë„¤ì¼">
											</div>
											<!-- í›„ê¸° íŒì—… -->
											<div class="review-popup">
												<button class="popup-close">Ã—</button>
												<div class="review-item">
													<p th:text="${record.recordDescription}">æ´»å‹•èª¬æ˜</p>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!-- â–¶ ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ -->
							<button class="gallery-arrow gallery-next">â–¶</button>
						</div>

						<!-- í˜ì´ì§• ë„íŠ¸ (4ê°œ ë‹¨ìœ„ë¡œ) -->
						<div class="gallery-dots" th:if="${#lists.size(recordSlides) > 1}">
							<div th:each="slide, stat : ${recordSlides}" class="gallery-dot"
								th:classappend="${stat.index == 0} ? ' active'">
							</div>
						</div>
					</section>
					<!-- ë‹¤ì‹œ ì—´ê¸° ë²„íŠ¼ -->
					<button id="invite-toggle-btn" class="invite-reopen-btn" style="display: none;">ğŸ“©</button>

				</div>
			</div>
		</div>

		<script>
			// íƒ­ ì „í™˜ ê¸°ëŠ¥
			document.addEventListener("DOMContentLoaded", () => {
				document.querySelectorAll('.band-tab-btn').forEach(button => {
					button.addEventListener('click', () => {
						document.querySelectorAll('.band-tab-btn').forEach(btn => btn.classList.remove('active'));
						document.querySelectorAll('.band-section').forEach(section => section.classList.remove('active'));
						button.classList.add('active');
						document.getElementById(button.getAttribute('data-target')).classList.add('active');
					});
				});
			});
		</script>

		<script>
			// í™œë™ì‚¬ì§„ ìŠ¬ë¼ì´ë“œ(í˜ì´ì§•) ê¸°ëŠ¥
			document.addEventListener("DOMContentLoaded", () => {
				const gallerySlides = document.querySelectorAll("#section-gallery .media-slide");
				const galleryDots = document.querySelectorAll("#section-gallery .gallery-dot");
				let galleryIndex = 0;

				if (gallerySlides.length === 0) return;

				function updateGallerySlide(newIndex) {
					gallerySlides[galleryIndex].classList.remove("active");
					galleryDots[galleryIndex]?.classList.remove("active");
					galleryIndex = newIndex;
					gallerySlides[galleryIndex].classList.add("active");
					galleryDots[galleryIndex]?.classList.add("active");
				}

				document.querySelector("#section-gallery .gallery-prev")?.addEventListener("click", () => {
					updateGallerySlide((galleryIndex - 1 + gallerySlides.length) % gallerySlides.length);
				});
				document.querySelector("#section-gallery .gallery-next")?.addEventListener("click", () => {
					updateGallerySlide((galleryIndex + 1) % gallerySlides.length);
				});
				galleryDots.forEach((dot, index) => {
					dot.addEventListener("click", () => updateGallerySlide(index));
				});
			});
		</script>

		<script>
			// í™œë™ê¸°ë¡ ìŠ¬ë¼ì´ë“œ(í˜ì´ì§•) ê¸°ëŠ¥
			document.addEventListener("DOMContentLoaded", () => {
				const allSlides = Array.from(document.querySelectorAll("#section-records .media-slide"));
				const dots = document.querySelectorAll("#section-records .gallery-dot");
				const prevBtn = document.querySelector("#section-records .gallery-prev");
				const nextBtn = document.querySelector("#section-records .gallery-next");
				const galleryDotsContainer = document.querySelector("#section-records .gallery-dots");

				if (allSlides.length <= 1) {
					// ìŠ¬ë¼ì´ë“œê°€ 1ê°œ ì´í•˜ì´ë©´ ëª¨ë‘ ë³´ì´ê³  ë²„íŠ¼ ì œê±°
					allSlides.forEach(slide => slide.classList.add("active"));
					prevBtn?.style.setProperty("display", "none");
					nextBtn?.style.setProperty("display", "none");
					if (galleryDotsContainer) galleryDotsContainer.style.display = "none";
					return;
				}

				let currentIndex = 0;

				function updateRecordSlide(newIndex) {
					// ìŠ¬ë¼ì´ë“œ ì „í™˜ ì²˜ë¦¬
					allSlides.forEach(slide => slide.classList.remove("active"));
					allSlides[newIndex].classList.add("active");

					// ë„íŠ¸ ì²˜ë¦¬
					dots.forEach(dot => dot.classList.remove("active"));
					dots[newIndex]?.classList.add("active");

					currentIndex = newIndex;
				}

				// ì´ˆê¸° ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ í™œì„±í™”
				updateRecordSlide(0);

				// â—€ ë²„íŠ¼
				prevBtn?.addEventListener("click", () => {
					const newIndex = (currentIndex - 1 + allSlides.length) % allSlides.length;
					updateRecordSlide(newIndex);
				});

				// â–¶ ë²„íŠ¼
				nextBtn?.addEventListener("click", () => {
					const newIndex = (currentIndex + 1) % allSlides.length;
					updateRecordSlide(newIndex);
				});

				// ë„íŠ¸ í´ë¦­
				dots.forEach((dot, index) => {
					dot.addEventListener("click", () => updateRecordSlide(index));
				});
			});
		</script>

		<script>
		  // í™œë™ê¸°ë¡ ì¹´ë“œ í´ë¦­ â†’ í›„ê¸° íŒì—… í•˜ë‚˜ë§Œ ì—´ë¦¬ë„ë¡ ì²˜ë¦¬
		  document.addEventListener("DOMContentLoaded", () => {
		    document.querySelectorAll('.record-card').forEach(card => {
		      card.addEventListener('click', () => {
		        // ëª¨ë“  popupì„ ë¨¼ì € ë‹«ëŠ”ë‹¤
		        document.querySelectorAll('.review-popup').forEach(popup => {
		          popup.style.display = 'none';
		        });

		        // ì„ íƒëœ ì¹´ë“œì˜ popupë§Œ ë³´ì´ë„ë¡
		        const popup = card.querySelector('.review-popup');
		        if (popup) {
		          popup.style.display = 'block';
		        }
		      });
		    });

		    // ë‹«ê¸° ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ìˆ¨ê¹€ ì²˜ë¦¬
		    document.querySelectorAll('.popup-close').forEach(btn => {
		      btn.addEventListener('click', (e) => {
		        e.stopPropagation();
		        const popup = btn.closest('.review-popup') || btn.closest('.keyword-popup');
		        if (popup) popup.style.display = 'none';
		      });
		    });
		  });
		</script>


		<script>
			// í™œë™ì‚¬ì§„ í´ë¦­ â†’ í›„ê¸° íŒì—… ì—´ê¸° + 'í™œë™ ì‚¬ì§„' íƒ­ í™œì„±í™” ê¸°ëŠ¥ + activity_photo_id ë¡œê¹…
			document.addEventListener("DOMContentLoaded", () => {
				document.querySelectorAll('.activity-thumb').forEach(el => {
					el.addEventListener('click', () => {

						// 1) ëª¨ë“  íƒ­ ë²„íŠ¼ì—ì„œ active ì œê±°
						document.querySelectorAll('.band-tab-btn').forEach(btn => btn.classList.remove('active'));

						// 2) 'í™œë™ ì‚¬ì§„' íƒ­ ë²„íŠ¼ì— active ì¶”ê°€
						const galleryBtn = document.querySelector('.band-tab-btn[data-target="section-gallery"]');
						if (galleryBtn) galleryBtn.classList.add('active');

						// 3) ëª¨ë“  íƒ­ ì„¹ì…˜ì—ì„œ active ì œê±°
						document.querySelectorAll('.band-section').forEach(sec => sec.classList.remove('active'));

						// 4) 'í™œë™ ì‚¬ì§„' ì„¹ì…˜ì— active ì¶”ê°€
						const gallerySection = document.getElementById('section-gallery');
						if (gallerySection) gallerySection.classList.add('active');

						const slide = el.closest('.media-slide');
						if (!slide) return;

						const title = slide.dataset.title || '';
						const desc = slide.dataset.desc || '';
						const photoId = slide.dataset.photoId || '';
						const youtube = slide.dataset.youtube || '';

						// í›„ê¸° íŒì—… ë‚´ìš© ê°±ì‹ 
						const popup = document.getElementById('activity-popup');
						popup.querySelector('.activity-popup-title').textContent = title;
						popup.querySelector('.activity-popup-desc').textContent = desc;

						// photoId ì½˜ì†” í™•ì¸
						console.log("ì„ íƒëœ activity_photo_id:", photoId);

						popup.style.display = 'block';
					});
				});
			});
		</script>

		<script>
			// ì»¤ë²„ ì´ë¯¸ì§€ ìˆ˜ì •
			function initCoverImageEdit() {
			  const isLeader = document.body.dataset.isLeader === "true";
			  if (!isLeader) return;

			  const coverImageDiv = document.querySelector(".cover-image");
			  const coverImg = coverImageDiv?.querySelector("img");

			  if (!coverImageDiv || document.getElementById("cover-file-btn")) return;

			  const coverBtn = document.createElement("button");
			  coverBtn.id = "cover-file-btn";
			  coverBtn.type = "button";
			  coverBtn.textContent = "ã‚«ãƒãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸å¤‰æ›´";
			  coverBtn.className = "btn-primary";

			  Object.assign(coverBtn.style, {
			    position: "absolute",
			    top: "10px",
			    right: "10px",
			    width: "120px",
			    height: "36px",
			    fontSize: "14px",
			    backgroundColor: "rgba(0,0,0,0.7)",
			    color: "#fff",
			    border: "none",
			    borderRadius: "6px",
			    padding: "2px 4px",
			    cursor: "pointer",
			    zIndex: "10"
			  });

			  coverImageDiv.style.position = "relative";
			  coverImageDiv.appendChild(coverBtn);

			  // inputì´ ì—†ìœ¼ë©´ ìƒì„±
			  let input = document.querySelector("input[type='file'][name='coverFile']");
			  if (!input) {
			    input = document.createElement("input");
			    input.type = "file";
			    input.name = "coverFile";
			    input.accept = "image/*";
			    input.style.display = "none";
			    document.body.appendChild(input);

			    input.addEventListener("change", (e) => {
			      const file = e.target.files[0];
			      if (file) {
			        const reader = new FileReader();
			        reader.onload = (event) => {
			          if (coverImg) {
			            coverImg.src = event.target.result;
			          }
			        };
			        reader.readAsDataURL(file);

			        const bandId = document.getElementById("band-id")?.textContent.trim();
			        const formData = new FormData();
			        formData.append("bandId", bandId);
			        formData.append("coverFile", file);

			        const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
			        const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
			        if (csrfToken && csrfParam) {
			          formData.append(csrfParam, csrfToken);
			        }

			        fetch("/bandinsertselect/updateCoverImage", {
			          method: "POST",
			          body: formData
			        })
			          .then(res => {
			            if (res.ok) {
			              alert("ã‚«ãƒãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
			              document.getElementById("edit-toggle-btn")?.click(); // ìˆ˜ì •ëª¨ë“œ ì¢…ë£Œ
			            } else {
			              alert("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—");
			            }
			          })
			          .catch(err => {
			            console.error("è»¢é€ã‚¨ãƒ©ãƒ¼:", err);
			            alert("è»¢é€å¤±æ•—");
			          });
			      }
			    });
			  }

			  coverBtn.addEventListener("click", () => input.click());
			}

		</script>

		<script>
			// í”„ë¡œí•„(ì´ë¦„/í•¸ë“¤/í•œì¤„ì†Œê°œ) ì˜ì—­ ìˆ˜ì •ëª¨ë“œ
			function initProfileEdit() {
			    const isLeader = document.body.dataset.isLeader === "true";
			    if (!isLeader) return;

			    if (window.profileEditBtnCreated) return;
			    window.profileEditBtnCreated = true;

			    const profileContainer = document.querySelector(".profile-thumbnail");
			    const profileImage = profileContainer?.querySelector("img");

			    const profileBtn = document.createElement("button");
			    profileBtn.id = "profile-file-btn";
			    profileBtn.type = "button";
			    profileBtn.textContent = "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å¤‰æ›´";
			    profileBtn.className = "btn-primary";

			    Object.assign(profileBtn.style, {
			      position: "absolute",
			      bottom: "8px",
			      left: "50%",
			      transform: "translateX(-50%)",
			      width: "90px",
			      height: "26px",
			      fontSize: "12px",
			      backgroundColor: "rgba(0,0,0,0.7)",
			      color: "#fff",
			      border: "none",
			      borderRadius: "6px",
			      padding: "2px 4px",
			      cursor: "pointer",
			      zIndex: "10"
			    });

			    const wrapper = document.createElement("div");
			    wrapper.id = "profile-btn-wrapper";
			    wrapper.style.position = "relative";
			    wrapper.appendChild(profileBtn);

			    if (profileContainer) {
			      profileContainer.appendChild(wrapper);
			    }

			    // inputì´ ì—†ìœ¼ë©´ ìƒì„±
			    let input = document.querySelector("input[type='file'][name='profileImage']");
			    if (!input) {
			      input = document.createElement("input");
			      input.type = "file";
			      input.name = "profileImage";
			      input.accept = "image/*";
			      input.style.display = "none";
			      document.body.appendChild(input);

			      input.addEventListener("change", (e) => {
			        const file = e.target.files[0];
			        if (file) {
			          const reader = new FileReader();
			          reader.onload = (event) => {
			            if (profileImage) {
			              profileImage.src = event.target.result;
			            }
			          };
			          reader.readAsDataURL(file);

			          const bandId = document.getElementById("band-id")?.textContent.trim();
			          const formData = new FormData();
			          formData.append("bandId", bandId);
			          formData.append("profileImage", file);

			          const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
			          const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
			          if (csrfToken && csrfParam) {
			            formData.append(csrfParam, csrfToken);
			          }

			          fetch("/bandinsertselect/updateProfileImage", {
			            method: "POST",
			            body: formData
			          })
			            .then(res => {
			              if (res.ok) {
			                alert("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
			                document.getElementById("edit-toggle-btn")?.click();
			              } else {
			                alert("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—");
			              }
			            })
			            .catch(err => {
			              console.error("è»¢é€ã‚¨ãƒ©ãƒ¼:", err);
			              alert("è»¢é€å¤±æ•—");
			            });
			        }
			      });
			    }

			    profileBtn.addEventListener("click", () => input.click());
			  }

		</script>

		<script>
			// ë°´ë“œ ì´ë¥¾ ìˆ˜ì •
			function initBandNameEdit() {
			  const el = document.querySelector(".band-name");
			  if (!el || el.querySelector("input")) return;

			  const bandId = document.getElementById("band-id")?.textContent.trim();
			  const val = el.textContent.trim();
			  el.innerHTML = `<input type="text" name="bandName" value="${val}" style="width: 100%; padding: 10px;">`;

			  const input = el.querySelector("input");
			  const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
			  const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

			  input.addEventListener("blur", (e) => {
			    const value = e.target.value.trim();
			    const formData = new FormData();
			    formData.append("bandId", bandId);
			    formData.append("bandName", value);
			    if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

			    fetch("/bandinsertselect/updateBandName", {
			      method: "POST",
			      body: formData
			    })
			    .then(res => {
			      if (!res.ok) {
			        alert("ãƒãƒ³ãƒ‰åä¿å­˜å¤±æ•—");
			      } else {
			        alert("ãƒãƒ³ãƒ‰åãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
			        sessionStorage.setItem("editMode", "false"); 
					sessionStorage.setItem("justExitedEditMode", "true");
			        location.reload();                           
			      }
			    })
			    .catch(err => {
			      console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
			      alert("ä¿å­˜å¤±æ•—");
			    });
			  });
			}
		</script>
		
		<script>
			// ë¦¬ë” ì½”ë©˜íŠ¸ ìˆ˜ì •
			function initLeaderCommentEdit() {
			  const el = document.querySelector(".band-leader-comment");
			  if (!el || el.querySelector("input")) return;

			  const bandId = document.getElementById("band-id")?.textContent.trim();
			  const val = el.textContent.trim();
			  el.innerHTML = `<input type="text" name="leaderComment" value="${val}" style="width: 100%; padding: 10px;">`;

			  const input = el.querySelector("input");
			  const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
			  const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

			  input.addEventListener("blur", (e) => {
			    const value = e.target.value.trim();
			    const formData = new FormData();
			    formData.append("bandId", bandId);
			    formData.append("leaderComment", value);
			    if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

			    fetch("/bandinsertselect/updateLeaderComment", {
			      method: "POST",
			      body: formData
			    })
			    .then(res => {
			      if (!res.ok) {
			        alert("ãƒªãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆä¿å­˜å¤±æ•—");
			      } else {
			        alert("ãƒªãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
			        sessionStorage.setItem("editMode", "false"); 
					sessionStorage.setItem("justExitedEditMode", "true");
			        location.reload();                      
			      }
			    })
			    .catch(err => {
			      console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
			      alert("è»¢é€å¤±æ•—");
			    });
			  });
			}
		</script>

		<script>
		  // ë°´ë“œ ì†Œê°œ ìˆ˜ì •
		  function initOneLinerEdit() {
		    const el = document.querySelector(".band-one-liner");
		    if (!el || el.querySelector("textarea")) return;

		    const bandId = document.getElementById("band-id")?.textContent.trim();
		    const val = el.textContent.trim();

		    el.innerHTML = `<textarea name="bandOneLiner" style="width: 100%; padding: 10px; height: 120px;">${val}</textarea>`;

		    const textarea = el.querySelector("textarea");
		    const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		    const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

		    textarea.addEventListener("blur", () => {
		      const value = textarea.value.trim();
		      const formData = new FormData();
		      formData.append("bandId", bandId);
		      formData.append("bandOneLiner", value);
		      if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

		      fetch("/bandinsertselect/updateBandOneLiner", {
		        method: "POST",
		        body: formData
		      })
		        .then(res => {
		          if (!res.ok) {
		            alert("ãƒãƒ³ãƒ‰ç´¹ä»‹ä¿å­˜å¤±æ•—");
		          } else {
		            alert("ãƒãƒ³ãƒ‰ç´¹ä»‹ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚"); 
		            sessionStorage.setItem("editMode", "false");
					sessionStorage.setItem("justExitedEditMode", "true");
		            location.reload(); 
		          }
		        })
		        .catch(err => {
		          console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
		          alert("è»¢é€å¤±æ•—");
		        });
		    });
		  }
		</script>
		
		<script>
		  // ìœ íŠœë¸Œ ì±„ë„ ì£¼ì†Œ ìˆ˜ì •
		  function initYoutubeLinkEdit() {
		    const el = document.getElementById("youtube-link");
		    if (!el || el.querySelector("input")) return;

		    const bandId = document.getElementById("band-id")?.textContent.trim();
		    const val = el.getAttribute("href") || "";
		    el.outerHTML = `
		      <input type="text" id="youtube-link" name="youtubeLink" value="${val}" style="width: 100%; padding: 10px;">
		    `;

		    const input = document.getElementById("youtube-link");
		    const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		    const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

		    input.addEventListener("blur", () => {
		      const value = input.value.trim();
		      const formData = new FormData();
		      formData.append("bandId", bandId);
		      formData.append("youtubeLink", value);
		      if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

		      fetch("/bandinsertselect/updateYoutubeLink", {
		        method: "POST",
		        body: formData
		      })
		        .then(res => {
		          if (!res.ok) {
		            alert("ãƒ¦ãƒ¼ãƒãƒ¥ãƒ¼ãƒ–ã‚¢ãƒ‰ãƒ¬ã‚¹ä¿å­˜å¤±æ•—");
		          } else {
		            alert("ãƒ¦ãƒ¼ãƒãƒ¥ãƒ¼ãƒ–ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
		            sessionStorage.setItem("editMode", "false");
					sessionStorage.setItem("justExitedEditMode", "true");
		            location.reload();
		          }
		        })
		        .catch(err => {
		          console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
		          alert("è»¢é€å¤±æ•—");
		        });
		    });
		  }
		</script>

		<script>
			// ì¸ìŠ¤íƒ€ ì£¼ì†Œ ìˆ˜ì •
			function initInstagramEdit() {
			  const el = document.getElementById("instagram-link");
			  if (!el || el.querySelector("input")) return;

			  const bandId = document.getElementById("band-id")?.textContent.trim();
			  const val = el.getAttribute("href") || "";

			  el.outerHTML = `
			    <input type="text" id="instagram-link" name="instagramLink" value="${val}" style="width: 100%; padding: 10px;">
			  `;

			  const input = document.getElementById("instagram-link");
			  const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
			  const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

			  input.addEventListener("blur", () => {
			    const value = input.value.trim();
			    const formData = new FormData();
			    formData.append("bandId", bandId);
			    formData.append("instagramLink", value);
			    if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

			    fetch("/bandinsertselect/updateInstagramLink", {
			      method: "POST",
			      body: formData
			    })
			      .then(res => {
			        if (!res.ok) {
			          alert("ã‚¤ãƒ³ã‚¹ã‚¿ã‚¢ãƒ‰ãƒ¬ã‚¹ä¿å­˜å¤±æ•—");
			        } else {
			          alert("ã‚¤ãƒ³ã‚¹ã‚¿ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
			          sessionStorage.setItem("editMode", "false");
					  sessionStorage.setItem("justExitedEditMode", "true");
			          location.reload();
			        }
			      })
			      .catch(err => {
			        console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
			        alert("è»¢é€å¤±æ•—");
			      });
			  });
			}
		</script>
		<script>
		  // ê²°ì„±ì¼ ìˆ˜ì •
		  function initFormationDateEdit() {
		    const li = Array.from(document.querySelectorAll("#section-intro .intro-list li"))
		      .find(el => el.textContent.includes("ê²°ì„±ì¼"));
		    if (!li || li.querySelector("input")) return;

		    const label = li.querySelector("strong")?.textContent.trim();
		    const val = li.querySelector(".formation-date")?.textContent.trim();
		    const bandId = document.getElementById("band-id")?.textContent.trim();

		    // ì´ë¯¸ yyyy-MM-dd í˜•ì‹ìœ¼ë¡œ ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë³„ë„ì˜ íŒŒì‹± ì—†ì´ ë°”ë¡œ ì‚¬ìš©
		    const defaultDate = val || "";

		    li.innerHTML = `
		      <strong>${label}</strong>
		      <input type="date" name="formationDate" value="${defaultDate}" style="padding: 10px;">
		    `;

		    const input = li.querySelector("input");
		    const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		    const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

		    input.addEventListener("blur", (e) => {
		      const value = e.target.value;
		      const formData = new FormData();
		      formData.append("bandId", bandId);
		      formData.append("formationDate", value);
		      if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

		      fetch("/bandinsertselect/updateFormationDate", {
		        method: "POST",
		        body: formData
		      })
		      .then(res => {
		        if (!res.ok) {
		          alert("çµæˆæ—¥ä¿å­˜å¤±æ•—");
		        } else {
		          alert("çµæˆæ—¥ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
		          document.getElementById("edit-toggle-btn")?.click();
		        }
		      })
		      .catch(err => {
		        console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
		        alert("è»¢é€å¤±æ•—");
		      });
		    });
		  }

		</script>

		<script>
		  // ì¥ë¥´ í† ê¸€ ìˆ˜ì •
		  function initGenreTagEdit() {
		    const genreLi = Array.from(document.querySelectorAll("#section-intro .intro-list li"))
		      .find(li => li.textContent.includes("ì¥ë¥´"));
		    if (!genreLi) return;

		    // ì‰¼í‘œë¡œ ë¶„í•´í•´ì„œ ì •í™•íˆ íƒœê·¸ë³„ ë°°ì—´ë¡œ ë³€í™˜
		    const initialTags = Array.from(genreLi.querySelectorAll(".tag-item"))
		      .flatMap(el => el.textContent.split(','))
		      .map(tag => tag.trim())
		      .filter(Boolean);

		    genreLi.innerHTML = `
		      <strong>ì¥ë¥´ : </strong>
		      <input type="text" id="genre-input" name="genre" value="${initialTags.join(', ')}" readonly style="cursor: pointer;">
		    `;

		    const genreInput = document.getElementById("genre-input");
		    const genrePopup = document.getElementById("genre-popup");
		    const popupTags = genrePopup.querySelectorAll(".tag");
		    const closeBtn = document.getElementById("genre-popup-close");

		    // ì´ˆê¸° ì„ íƒëœ íƒœê·¸ ê°•ì¡° (.active ì ìš©)
		    popupTags.forEach(tag => {
		      const tagText = tag.textContent.trim();
		      tag.classList.toggle("active", initialTags.includes(tagText));
		    });

		    genreInput.addEventListener("click", (e) => {
		      e.stopPropagation();
		      genrePopup.style.display = "block";
		    });

		    popupTags.forEach(tag => {
		      tag.addEventListener("click", (e) => {
		        e.stopPropagation();
		        tag.classList.toggle("active");

		        const selected = Array.from(genrePopup.querySelectorAll(".tag.active"))
		          .map(t => t.textContent.trim())
		          .filter(Boolean);

		        genreInput.value = selected.join(', ');
		      });
		    });

		    closeBtn.addEventListener("click", () => {
		      genrePopup.style.display = "none";

		      const bandId = document.getElementById("band-id")?.textContent.trim();
		      const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		      const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

		      const formData = new FormData();
		      formData.append("bandId", bandId);
		      formData.append("genre", genreInput.value.trim().replace(/,\s*,+/g, ', '));
		      formData.append("position", "");
		      formData.append("gender", "");
		      formData.append("age", "");
		      if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

		      fetch("/bandinsertselect/updateBandIntro", {
		        method: "POST",
		        body: formData
		      }).then(res => {
		        if (res.ok) {
		          alert("ã‚¸ãƒ£ãƒ³ãƒ«ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
		          sessionStorage.setItem("editMode", "false");
				  sessionStorage.setItem("justExitedEditMode", "true");
		          location.reload();
		        } else {
		          alert("ã‚¸ãƒ£ãƒ³ãƒ«ä¿å­˜å¤±æ•—");
		        }
		      }).catch(err => {
		        console.error("ã‚¸ãƒ£ãƒ³ãƒ«ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
		        alert("ã‚¸ãƒ£ãƒ³ãƒ«ä¿å­˜å¤±æ•—");
		      });
		    });

		    document.addEventListener("click", (e) => {
		      if (!e.target.closest("#genre-popup") && e.target.id !== "genre-input") {
		        genrePopup.style.display = "none";
		      }
		    });
		  }
		</script>

		<script>
		  // í™œë™ì§€ì—­ ìˆ˜ì •
		  function initRegionEdit() {
		    const el = document.querySelector(".band-region");
		    if (!el || el.querySelector("input")) return;

		    const bandId = document.getElementById("band-id")?.textContent.trim();
		    const val = el.textContent.trim();

		    el.innerHTML = `
		      <input type="text" name="region" value="${val}" style="width: 100%; padding: 10px;">
		    `;

		    const input = el.querySelector("input");
		    const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		    const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;

		    input.addEventListener("blur", () => {
		      const value = input.value.trim();
		      const formData = new FormData();
		      formData.append("bandId", bandId);
		      formData.append("region", value);
		      if (csrfToken && csrfParam) formData.append(csrfParam, csrfToken);

		      fetch("/bandinsertselect/updateRegion", {
		        method: "POST",
		        body: formData
		      })
		        .then(res => {
		          if (!res.ok) {
		            alert("æ´»å‹•åœ°åŸŸä¿å­˜å¤±æ•—");
		          } else {
		            alert("æ´»å‹•åœ°åŸŸãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
		            sessionStorage.setItem("editMode", "false");
					sessionStorage.setItem("justExitedEditMode", "true");
		            location.reload(); 
		          }
		        })
		        .catch(err => {
		          console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
		          alert("è»¢é€å¤±æ•—");
		        });
		    });
		  }
		</script>
		
		<script>
		  // ë°´ë“œ ì†Œê°œ(ì´ë¦„, í•œ ì¤„ ì†Œê°œ, ì¥ë¥´) ìˆ˜ì • ê¸°ëŠ¥ ì´ˆê¸°í™”
		  function initBandIntro() {
		    initBandNameEdit();      // ë°´ë“œ ì´ë¦„ inputìœ¼ë¡œ ë³€ê²½
		    initOneLinerEdit();      // í•œ ì¤„ ì†Œê°œ inputìœ¼ë¡œ ë³€ê²½
		    initGenreTagEdit();      // ì¥ë¥´ ì„ íƒ íŒì—… ë„ì›€
			initLeaderCommentEdit(); // ë¦¬ë” ì½”ë©˜íŠ¸
			initFormationDateEdit(); // ê²°ì„±ì¼
			initRegionEdit(); // í™œë™ ì§€ì—­
			initLeaderPopupEdit();  
			initMemberPopupEdit(); 
			initYoutubeLinkEdit(); // ìœ íŠœë¸Œ ì±„ë„
			initInstagramEdit(); // ì¸ìŠ¤íƒ€ ì£¼ì†Œ
		  }
		</script>
		
		<script>
			// í”„ë¡œí•„ ì‚¬ì§„ ìˆ˜ì •
			function initProfileImage() {
			  const isLeader = document.body.dataset.isLeader === "true";
			  if (!isLeader) return;

			  const profileContainer = document.querySelector(".profile-thumbnail");
			  const profileImage = document.querySelector(".profile-thumbnail > img");

			  if (!document.getElementById("profile-file-btn")) {
			    const profileBtn = document.createElement("button");
			    profileBtn.id = "profile-file-btn";
			    profileBtn.type = "button";
			    profileBtn.textContent = "í”„ë¡œí•„ ë³€ê²½";
			    profileBtn.className = "btn-primary";

			    profileContainer.style.position = "relative";
			    Object.assign(profileBtn.style, {
			      position: "absolute",
			      bottom: "8px",
			      left: "50%",
			      transform: "translateX(-50%)",
			      width: "90px",
			      height: "26px",
			      fontSize: "12px",
			      backgroundColor: "rgba(0,0,0,0.7)",
			      color: "#fff",
			      border: "none",
			      borderRadius: "6px",
			      padding: "2px 4px",
			      cursor: "pointer",
			      zIndex: "10"
			    });

			    profileContainer.appendChild(profileBtn);

			    profileBtn.addEventListener("click", () => {
			      let input = document.querySelector("input[type='file'][name='profileImage']");

			      if (!input) {
			        input = document.createElement("input");
			        input.type = "file";
			        input.name = "profileImage";
			        input.accept = "image/*";
			        input.style.display = "none";
			        document.body.appendChild(input);

			        input.addEventListener("change", (e) => {
			          const file = e.target.files[0];
			          if (file) {
			            const reader = new FileReader();
			            reader.onload = (event) => {
			              if (profileImage) {
			                profileImage.src = event.target.result; 
			              }
			            };
			            reader.readAsDataURL(file);

			            const bandId = document.getElementById("band-id")?.textContent.trim();
			            const formData = new FormData();
			            formData.append("bandId", bandId);
			            formData.append("profileImage", file);

			            const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
			            const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
			            if (csrfToken && csrfParam) {
			              formData.append(csrfParam, csrfToken);
			            }

			            fetch("/bandinsertselect/updateProfileImage", {
			              method: "POST",
			              body: formData
			            })
			              .then(res => {
			                if (res.ok) {
			                  alert("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
			                  document.getElementById("edit-toggle-btn")?.click();
			                } else {
			                  alert("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—");
			                }
			              })
			              .catch(err => {
			                console.error("è»¢é€ã‚¨ãƒ©ãƒ¼:", err);
			                alert("è»¢é€å¤±æ•—");
			              });
			          }
			        });
			      }

			      input.click();
			    });
			  }
			}
		</script>
		
		<script>
		  // ë©¤ë²„ ì†Œê°œ ìˆ˜ì • (ë¦¬ë”)
		  function initLeaderPopupEdit() {
		    const card = document.querySelector(".leader-only .member-card");
		    const popup = card?.querySelector(".member-popup");

		    card?.addEventListener("click", (e) => {
		      e.stopPropagation();
		      if (!popup) return;

		      // ì´ë¯¸ í¸ì§‘ ê°€ëŠ¥í•œ ìƒíƒœë©´ íŒì—…ë§Œ ì—´ê¸°
		      if (popup.dataset.editable === "true") {
		        popup.style.display = "block";
		        return;
		      }

		      popup.dataset.editable = "true";
		      popup.style.display = "block";
		      popup.style.pointerEvents = "auto";
		      popup.style.background = "#fff";
		      popup.style.padding = "10px";

		      const name = card.dataset.stageName || "";
		      const position = card.dataset.memberPosition || "";
		      const mbti = card.dataset.memberMbti || "";
		      const band = card.dataset.favoriteBand || "";
		      const motto = card.dataset.memberMotto || "";

		      popup.innerHTML = `
		        <label>æ´»å‹•åã€€: <input type="text" name="stage_name" value="${name}"></label><br>
		        <label>ãƒã‚¸ã‚·ãƒ§ãƒ³ã€€: <input type="text" name="member_position" value="${position}"></label><br>
		        <label>MBTIã€€: <input type="text" name="member_mbti" value="${mbti}"></label><br>
		        <label>å¥½ã¿ã®ãƒãƒ³ãƒ‰ã€€: <input type="text" name="favorite_band" value="${band}"></label><br>
		        <label>ä¸€è¨€ã€€: <textarea name="member_motto">${motto}</textarea></label><br>
		        <div style="text-align: center; margin-top: 10px;">
		          <button class="save-member-btn" style="padding:8px 16px; border:none; border-radius:6px; background:#000; color:#fff; cursor:pointer;">ì €ì¥</button>
		        </div>
		      `;

		      // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		      popup.querySelector(".save-member-btn").addEventListener("click", () => {
		        const stage_name = popup.querySelector("input[name='stage_name']").value.trim();
		        const member_position = popup.querySelector("input[name='member_position']").value.trim();
		        const member_mbti = popup.querySelector("input[name='member_mbti']").value.trim();
		        const favorite_band = popup.querySelector("input[name='favorite_band']").value.trim();
		        const member_motto = popup.querySelector("textarea[name='member_motto']").value.trim();

		        const memberId = card.getAttribute("data-member-id");
		        const bandId = document.getElementById("band-id")?.textContent.trim();

		        const formData = new FormData();
		        formData.append("bandId", bandId);
		        formData.append("bandMemberId", memberId);
		        formData.append("stage_name", stage_name);
		        formData.append("member_position", member_position);
		        formData.append("member_mbti", member_mbti);
		        formData.append("favorite_band", favorite_band);
		        formData.append("member_motto", member_motto);
		        formData.append("member_type", "leader"); 

		        // CSRF í† í°
		        const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		        const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
		        if (csrfToken && csrfParam) {
		          formData.append(csrfParam, csrfToken);
		        }

		        // ì „ì†¡
		        fetch("/bandinsertselect/updateMemberInfo", {
		          method: "POST",
		          body: formData
		        })
		        .then(res => {
		          if (res.ok) {
		            alert("ãƒ¡ãƒ³ãƒãƒ¼ç´¹ä»‹ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
		            sessionStorage.setItem("editMode", "false");
					sessionStorage.setItem("justExitedEditMode", "true");
		            location.reload();
		          } else {
		            alert("ä¿å­˜å¤±æ•—");
		          }
		        })
		        .catch(err => {
		          console.error("è»¢é€ã‚¨ãƒ©ãƒ¼:", err);
		          alert("è»¢é€å¤±æ•—");
		        });
		      });
		    });

		    // íŒì—… ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
		    document.addEventListener("click", (e) => {
		      if (!e.target.closest(".member-card")) {
		        if (popup?.style) popup.style.display = "none";
		      }
		    });
		  }
		</script>
		
		<script>
		  // ë¦¬ë” ì†Œê°œ ë§ˆìš°ìŠ¤ ì˜¤ë²„ íŒì—…
		  function initLeaderPopupHover() {
		    const card = document.querySelector("#section-members .leader-only .member-card");
		    const popup = card?.querySelector(".member-popup");
		    if (!card || !popup) return;

		    // ë°ì´í„° ì†ì„± ì¶”ì¶œ
		    const name = card.dataset.stageName || "";
		    const position = card.dataset.memberPosition || "";
		    const mbti = card.dataset.memberMbti || "";
		    const band = card.dataset.favoriteBand || "";
		    const motto = card.dataset.memberMotto || "";

		    // popup ë‚´ìš© êµ¬ì„±
		    popup.innerHTML = `
		      <div style="line-height: 1.6; display: flex; flex-direction: column; gap: 4px;">
		        <div><strong>æ´»å‹•åã€€:</strong> <span>${name}</span></div>
		        <div><strong>ãƒã‚¸ã‚·ãƒ§ãƒ³ã€€:</strong> <span>${position}</span></div>
		        <div><strong>MBTIã€€:</strong> <span>${mbti}</span></div>
		        <div><strong>å¥½ã¿ã®ãƒãƒ³ãƒ‰ã€€:</strong> <span>${band}</span></div>
		        <div><strong>ä¸€è¨€ã€€:</strong> <span>${motto}</span></div>
		      </div>
		    `;

		    Object.assign(popup.style, {
		      position: "absolute",
		      top: "70px",
		      left: "50%",
		      transform: "translateX(-50%)",
		      display: "none",
		      background: "#fff",
		      border: "1px solid #ccc",
		      padding: "12px 16px",
		      borderRadius: "8px",
		      boxShadow: "0 2px 8px rgba(0, 0, 0, 0.15)",
		      zIndex: "999",
		      whiteSpace: "normal",
		      minWidth: "200px",
		      maxWidth: "260px",
		      fontSize: "14px"
		    });

		    card.style.position = "relative";

		    card.addEventListener("mouseenter", () => {
		      popup.style.display = "block";
		    });

		    card.addEventListener("mouseleave", () => {
		      popup.style.display = "none";
		    });
		  }

		  // ë¬¸ì„œ ë¡œë”© í›„ ì‹¤í–‰
		  document.addEventListener("DOMContentLoaded", () => {
		    initLeaderPopupHover();
		  });
		</script>



		<script>
		  // ë©¤ë²„ ì†Œê°œ ìˆ˜ì • (ì¼ë°˜ ë©¤ë²„)
		  function initMemberPopupEdit() {
		    document.querySelectorAll("#section-members .member-container:not(.leader-only) .member-card").forEach(card => {
		      const popup = card.querySelector(".member-popup");

		      card.addEventListener("click", (e) => {
		        e.stopPropagation();
		        if (!popup || !window.editMode) return;

		        if (popup.dataset.editable === "true") {
		          popup.style.display = "block";
		          return;
		        }

		        popup.dataset.editable = "true";
		        popup.style.display = "block";

		        const name = card.dataset.stageName || "";
		        const position = card.dataset.memberPosition || "";
		        const mbti = card.dataset.memberMbti || "";
		        const band = card.dataset.favoriteBand || "";
		        const motto = card.dataset.memberMotto || "";

		        popup.innerHTML = `
		          <div style="display: flex; flex-direction: column; gap: 12px; padding: 16px;">
		            <label style="font-weight: bold;">æ´»å‹•åã€€:
		              <input type="text" name="stage_name" value="${name}" style="width:100%; padding:10px; border-radius:6px; border:1px solid #ccc;">
		            </label>
		            <label style="font-weight: bold;">ãƒã‚¸ã‚·ãƒ§ãƒ³ã€€:
		              <input type="text" name="member_position" value="${position}" style="width:100%; padding:10px; border-radius:6px; border:1px solid #ccc;">
		            </label>
		            <label style="font-weight: bold;">MBTIã€€:
		              <input type="text" name="member_mbti" value="${mbti}" style="width:100%; padding:10px; border-radius:6px; border:1px solid #ccc;">
		            </label>
		            <label style="font-weight: bold;">å¥½ã¿ã®ãƒãƒ³ãƒ‰ã€€:
		              <input type="text" name="favorite_band" value="${band}" style="width:100%; padding:10px; border-radius:6px; border:1px solid #ccc;">
		            </label>
		            <label style="font-weight: bold;">ä¸€è¨€ã€€:
		              <textarea name="member_motto" style="width:100%; height:80px; padding:10px; border-radius:6px; border:1px solid #ccc; resize: vertical;">${motto}</textarea>
		            </label>
		            <button class="save-member-btn" style="padding:10px; border:none; border-radius:6px; background:#000; color:#fff; cursor:pointer;">ì €ì¥</button>
		          </div>
		        `;

		        Object.assign(popup.style, {
		          position: "absolute",
		          top: "70px",
		          left: "50%",
		          transform: "translateX(-50%)",
		          background: "#fff",
		          border: "1px solid #ccc",
		          borderRadius: "10px",
		          boxShadow: "0 2px 12px rgba(0,0,0,0.2)",
		          minWidth: "260px",
		          zIndex: "1000",
		          fontSize: "14px"
		        });

		        // ì €ì¥ ì²˜ë¦¬
		        popup.querySelector(".save-member-btn").addEventListener("click", () => {
		          const stage_name = popup.querySelector("input[name='stage_name']").value.trim();
		          const member_position = popup.querySelector("input[name='member_position']").value.trim();
		          const member_mbti = popup.querySelector("input[name='member_mbti']").value.trim();
		          const favorite_band = popup.querySelector("input[name='favorite_band']").value.trim();
		          const member_motto = popup.querySelector("textarea[name='member_motto']").value.trim();
		          const memberId = card.getAttribute("data-member-id");
		          const bandId = document.getElementById("band-id")?.textContent.trim();

		          const formData = new FormData();
		          formData.append("bandId", bandId);
		          formData.append("bandMemberId", memberId);
		          formData.append("stage_name", stage_name);
		          formData.append("member_position", member_position);
		          formData.append("member_mbti", member_mbti);
		          formData.append("favorite_band", favorite_band);
		          formData.append("member_motto", member_motto);
		          formData.append("member_type", "member");

		          const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		          const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
		          if (csrfToken && csrfParam) {
		            formData.append(csrfParam, csrfToken);
		          }

		          fetch("/bandinsertselect/updateMemberInfo", {
		            method: "POST",
		            body: formData
		          })
		          .then(res => {
		            if (res.ok) {
		              alert("ãƒ¡ãƒ³ãƒãƒ¼ç´¹ä»‹ãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");
		              sessionStorage.setItem("editMode", "false");
					  sessionStorage.setItem("justExitedEditMode", "true");
		              location.reload();
		            } else {
		              alert("ä¿å­˜å¤±æ•—");
		            }
		          })
		          .catch(err => {
		            console.error("è»¢é€ã‚¨ãƒ©ãƒ¼:", err);
		            alert("è»¢é€å¤±æ•—");
		          });
		        });
		      });
		    });

		    // ì™¸ë¶€ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
		    document.addEventListener("click", (e) => {
		      if (!e.target.closest(".member-card")) {
		        document.querySelectorAll("#section-members .member-popup").forEach(p => {
		          p.style.display = "none";
		        });
		      }
		    });
		  }
		</script>

		<script>
			// ë©¤ë²„ ì†Œê°œ (ì¼ë°˜ ë©¤ë²„ íŒì—…ì°½)
			function initMemberPopupHover() {
			  document.querySelectorAll("#section-members .member-container:not(.leader-only) .member-card").forEach(card => {
			    const popup = card.querySelector(".member-popup");
			    if (!popup) return;

			    // ë°ì´í„° ì†ì„± ì¶”ì¶œ
			    const name = card.dataset.stageName || "";
			    const position = card.dataset.memberPosition || "";
			    const mbti = card.dataset.memberMbti || "";
			    const band = card.dataset.favoriteBand || "";
			    const motto = card.dataset.memberMotto || "";

			    // popup ë‚´ìš© êµ¬ì„± (í•œëˆˆì— ë³´ê¸° ì‰½ê²Œ ì •ë ¬)
			    popup.innerHTML = `
			      <div style="line-height: 1.6; display: flex; flex-direction: column; gap: 4px;">
			        <div><strong>æ´»å‹•å:</strong> <span>${name}</span></div>
			        <div><strong>ãƒã‚¸ã‚·ãƒ§ãƒ³:</strong> <span>${position}</span></div>
			        <div><strong>MBTI:</strong> <span>${mbti}</span></div>
			        <div><strong>å¥½ã‚€ã®ãƒãƒ³ãƒ‰:</strong> <span>${band}</span></div>
			        <div><strong>ä¸€è¨€:</strong> <span>${motto}</span></div>
			      </div>
			    `;

			    // popup ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì§€ì •
			    Object.assign(popup.style, {
			      position: "absolute",
			      top: "70px",
			      left: "50%",
			      transform: "translateX(-50%)",
			      display: "none",
			      background: "#fff",
			      border: "1px solid #ccc",
			      padding: "12px 16px",
			      borderRadius: "8px",
			      boxShadow: "0 2px 8px rgba(0, 0, 0, 0.15)",
			      zIndex: "999",
			      whiteSpace: "normal",
			      minWidth: "200px",
			      maxWidth: "260px",
			      fontSize: "14px"
			    });

			    // ì¹´ë“œ ìœ„ì¹˜ ì„¤ì •
			    card.style.position = "relative";

			    // hover ì´ë²¤íŠ¸
			    card.addEventListener("mouseenter", () => {
			      popup.style.display = "block";
			    });

			    card.addEventListener("mouseleave", () => {
			      popup.style.display = "none";
			    });
			  });
			}

			// ë¬¸ì„œ ë¡œë”© í›„ ì´ˆê¸°í™”
			document.addEventListener("DOMContentLoaded", () => {
			  initMemberPopupHover();
			});
		</script>

		<script>
			// íƒ­ ì „í™˜ ê¸°ëŠ¥
			document.addEventListener("DOMContentLoaded", () => {
				document.querySelectorAll('.band-tab-btn').forEach(button => {
					button.addEventListener('click', () => {
						document.querySelectorAll('.band-tab-btn').forEach(btn => btn.classList.remove('active'));
						document.querySelectorAll('.band-section').forEach(section => section.classList.remove('active'));
						button.classList.add('active');
						document.getElementById(button.getAttribute('data-target')).classList.add('active');

						const targetId = button.getAttribute("data-target");
						if (editMode) {
							if (targetId === "section-intro") {
								// ë°´ë“œì†Œê°œ íƒ­ì´ë©´ ì…ë ¥í¼ ìœ ì§€
							} else {
								// ë‹¤ë¥¸ íƒ­ì´ë©´ ì›ë˜ í…ìŠ¤íŠ¸ ë³µêµ¬
								restoreProfileInfo();
							}
						}
					});
				});
			});
		</script>

		<script>
			// íƒ­ ì „í™˜ ì‹œ ë°´ë“œì†Œê°œ ì…ë ¥í¼ ìœ ì§€/ë³µêµ¬
			document.addEventListener("DOMContentLoaded", () => {
				document.querySelectorAll(".band-tab-btn").forEach(btn => {
					btn.addEventListener("click", () => {
						const targetId = btn.getAttribute("data-target");

						if (window.editMode) {
							if (targetId === "section-intro") {
								// "ë°´ë“œ ì†Œê°œ" íƒ­ì´ë©´ ê¸°ì¡´ init í•¨ìˆ˜ í˜¸ì¶œë¡œ ìœ ì§€
								initBandIntro();
							} else {
								// ê·¸ ì™¸ íƒ­ì´ë©´ ì›ìƒë³µêµ¬
								restoreProfileInfo();
							}
						}
					});
				});
			});
		</script>

		<script>
			// í™œë™ì‚¬ì§„ ìˆ˜ì • ë²„íŠ¼ (ìˆ˜ì •ëª¨ë“œ ì§„ì… ì‹œ ìƒì„±)
			function initGalleryEditButton() {
				const sectionGallery = document.getElementById("section-gallery");

				if (!sectionGallery) return;
				if (window.editGalleryBtnCreated) return; // ì´ë¯¸ ìƒì„±í–ˆìœ¼ë©´ ë˜ ë§Œë“¤ì§€ ì•ŠìŒ

				// 1. í™œë™ì‚¬ì§„ ìˆ˜ì • ë²„íŠ¼ ìƒì„±
				const editGalleryBtn = document.createElement("button");
				editGalleryBtn.id = "edit-gallery-btn";
				editGalleryBtn.type = "button";
				editGalleryBtn.textContent = "æ´»å‹•å†™çœŸç·¨é›†";
				editGalleryBtn.className = "btn-primary edit-only";
				
				editGalleryBtn.style.position = "absolute";
				editGalleryBtn.style.top = "-40px";
				editGalleryBtn.style.right = "20px";
				editGalleryBtn.style.zIndex = "10";
				editGalleryBtn.style.padding = "10px 20px";
				editGalleryBtn.style.background = "#000";
				editGalleryBtn.style.color = "#fff";
				editGalleryBtn.style.borderRadius = "8px";
				editGalleryBtn.style.fontSize = "16px";
				editGalleryBtn.style.border = "none";
				editGalleryBtn.style.cursor = "pointer";

				sectionGallery.style.position = "relative";
				sectionGallery.appendChild(editGalleryBtn);

				window.editGalleryBtnCreated = true;

				// 2. íŒì—… ìƒì„±
				const galleryPopup = document.createElement("div");
				galleryPopup.id = "gallery-edit-popup";
				galleryPopup.style.cssText = `
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    border-radius: 12px;
    z-index: 1000;
    width: 400px;
    font-family: 'Noto Sans KR', sans-serif;
    color: #000;
    box-sizing: border-box;
  `;

				galleryPopup.innerHTML = `
    <h3 style="font-size:22px; font-weight:bold; text-align:center; margin-bottom:25px;">æ´»å‹•å†™çœŸç·¨é›†</h3>
    <input type="file" id="gallery-thumb-upload" accept="image/*" style="width:100%; margin-bottom:20px;">
    <input type="text" id="all-photo-youtube" name="youtubeUrl" placeholder="ãƒ¦ãƒ¼ãƒãƒ¥ãƒ¼ãƒ–ã‚¢ãƒ‰ãƒ¬ã‚¹ (ä¾‹: https://www.youtube.com/watch?v=XXXXXX)"
      style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; margin-bottom:10px;">
    <input type="text" id="gallery-title-input" placeholder="æ´»å‹•ã‚¿ã‚¤ãƒˆãƒ«" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; margin-bottom:10px;">
    <textarea id="gallery-desc-input" placeholder="æ´»å‹•èª¬æ˜" style="width:100%; height:100px; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; margin-bottom:10px; resize:vertical;"></textarea>
    <input type="hidden" id="edit-photo-id" name="activityPhotoId" value="">
    <div id="gallery-button-wrapper" style="display:flex; justify-content:center; align-items:center; gap:10px; margin-top:5px;">
      <button id="save-gallery-btn" class="btn-primary" style="background:#000; color:#fff; padding:12px 24px; font-size:15px; border:none; border-radius:8px; cursor:pointer;">ä¿å­˜ã™ã‚‹</button>
      <button id="close-gallery-popup" class="btn-primary" style="background:#fff; color:#000; border:1px solid #000; padding:12px 24px; font-size:15px; border-radius:8px; cursor:pointer;">é–‰ã‚ã‚‹</button>
    </div>
  `;

				document.body.appendChild(galleryPopup);

				// 3. ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ í˜„ì¬ ìŠ¬ë¼ì´ë“œ ë‚´ìš© ë°˜ì˜ + íŒì—… ì—´ê¸°
				editGalleryBtn.addEventListener("click", () => {
					const activeSlide = document.querySelector("#section-gallery .media-slide.active");
					if (!activeSlide) return;

					const thumbWrapper = activeSlide.querySelector(".gallery-grid");
					const imgEl = thumbWrapper?.querySelector("img");
					const title = thumbWrapper?.dataset.title || "";
					const desc = thumbWrapper?.dataset.desc || "";

					const iframe = activeSlide.querySelector("iframe");
					const youtubeEmbed = iframe?.getAttribute("src") || "";
					const youtubeId = youtubeEmbed.includes("embed/") ? youtubeEmbed.split("embed/")[1] : "";
					const youtubeFull = youtubeId ? `https://www.youtube.com/watch?v=${youtubeId}` : "";

					const photoId = activeSlide.querySelector(".photo-id")?.textContent.trim() || "";

					// inputì— ê°’ ì„¸íŒ…
					document.getElementById("gallery-title-input").value = title;
					document.getElementById("gallery-desc-input").value = desc;
					document.getElementById("all-photo-youtube").value = youtubeFull;
					document.getElementById("edit-photo-id").value = photoId;

					galleryPopup.style.display = "block";
				});

				// ë‹«ê¸° ë²„íŠ¼
				document.getElementById("close-gallery-popup").addEventListener("click", () => {
					galleryPopup.style.display = "none";
				});

				// ì €ì¥ ë²„íŠ¼
				document.getElementById("save-gallery-btn").addEventListener("click", () => {
					const title = document.getElementById("gallery-title-input").value.trim();
					const desc = document.getElementById("gallery-desc-input").value.trim();
					const youtubeUrl = document.getElementById("all-photo-youtube").value.trim();
					const activityPhotoId = document.getElementById("edit-photo-id").value;
					const bandId = document.getElementById("band-id").textContent.trim();
					const photoFile = document.getElementById("gallery-thumb-upload").files[0];

					if (!title || !desc) {
						alert("æ´»å‹•ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
						return;
					}

					const formData = new FormData();
					formData.append("activityPhotoId", activityPhotoId);
					formData.append("bandId", bandId);
					formData.append("title", title);
					formData.append("description", desc);
					formData.append("youtubeUrl", youtubeUrl);
					if (photoFile) {
						formData.append("photo", photoFile);
					}

					// CSRF í† í° ì²˜ë¦¬
					const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
					const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
					if (csrfToken && csrfParam) {
						formData.append(csrfParam, csrfToken);
					}

					fetch("/bandinsertselect/activeupdate", {
						method: "POST",
						body: formData
					})
						.then(response => {
							if (response.ok) {
								alert("æ´»å‹•å†™çœŸãŒå¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚");

								// ìˆ˜ì •ì™„ë£Œ ë²„íŠ¼ ìë™ í´ë¦­ â†’ ìˆ˜ì •ëª¨ë“œ ì¢…ë£Œ
								document.getElementById("edit-toggle-btn")?.click();

							} else {
								alert("ç·¨é›†å¤±æ•—");
							}
						})
						.catch(error => {
							console.error("ç·¨é›†å¤±æ•—ã€€:", error);
							alert("ç·¨é›†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
						});
				});
			}
		</script>

		<script>
			// í™œë™ ì‚¬ì§„ ì¶”ê°€ (ìˆ˜ì •ëª¨ë“œ ì§„ì… ì‹œ ìƒì„±)
			function initGalleryAddButton() {
				const sectionGallery = document.getElementById("section-gallery");
				if (!sectionGallery || !window.editMode || window.addAllBtnCreated) return;

				const addAllBtn = document.createElement("button");
				addAllBtn.id = "add-all-btn";
				addAllBtn.type = "button";
				addAllBtn.textContent = "æ´»å‹•å†™çœŸè¿½åŠ ";
				addAllBtn.className = "btn-primary edit-only";
				Object.assign(addAllBtn.style, {
					position: "absolute",
					top: "-40px",
					right: "140px",
					zIndex: "10",
					padding: "10px 20px",
					background: "#000",
					color: "#fff",
					borderRadius: "8px",
					fontSize: "16px",
					border: "none",
					cursor: "pointer",
					marginRight: "20px"
				});

				sectionGallery.style.position = "relative";
				sectionGallery.appendChild(addAllBtn);
				window.addAllBtnCreated = true;

				const allPopup = document.createElement("div");
				allPopup.id = "all-popup";
				allPopup.style.cssText = `
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    border-radius: 12px;
    z-index: 1000;
    width: 400px;
    font-family: 'Noto Sans KR', sans-serif;
    color: #000;
    box-sizing: border-box;
  `;

				allPopup.innerHTML = `
    <h3 style="font-size:22px; font-weight:bold; text-align:center; margin-bottom:25px;">æ´»å‹•å†™çœŸè¿½åŠ </h3>
    <form id="all-photo-form" method="post" enctype="multipart/form-data">
      <input type="file" id="new-all-photo" name="photo" accept="image/*" style="width:100%; margin-bottom:20px;">
      <input type="text" id="all-photo-youtube" name="youtubeUrl" placeholder="ãƒ¦ãƒ¼ãƒãƒ¥ãƒ¼ãƒ–ã‚¢ãƒ‰ãƒ¬ã‚¹ (ä¾‹: https://www.youtube.com/watch?v=XXXXXX)" 
        style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; margin-bottom:10px;">
      <input type="text" id="all-photo-title" name="title" placeholder="æ´»å‹•ã‚¿ã‚¤ãƒˆãƒ«" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; margin-bottom:10px;">
      <textarea id="all-photo-desc" name="description" placeholder="æ´»å‹•èª¬æ˜" style="width:100%; height:100px; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; margin-bottom:10px; resize:vertical;"></textarea>
      <div id="button-wrapper" style="display:flex; justify-content:center; align-items:center; gap:10px; margin-top:5px;">
        <button type="button" id="save-all-btn" class="btn-primary" style="background:#000; color:#fff; padding:12px 24px; font-size:15px; border:none; border-radius:8px; cursor:pointer;">ä¿å­˜ã™ã‚‹</button>
        <button type="button" id="close-all-popup" class="btn-primary" style="background:#fff; color:#000; border:1px solid #000; padding:12px 24px; font-size:15px; border-radius:8px; cursor:pointer;">é–‰ã‚ã‚‹</button>
      </div>
    </form>
  `;

				document.body.appendChild(allPopup);

				const form = allPopup.querySelector("#all-photo-form");

				// CSRF í† í° ì¶”ê°€
				const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
				const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.getAttribute('content');
				if (csrfToken && csrfParam) {
					const csrfInput = document.createElement("input");
					csrfInput.type = "hidden";
					csrfInput.name = csrfParam;
					csrfInput.value = csrfToken;
					form.appendChild(csrfInput);
				}

				// bandId hidden field ì¶”ê°€
				const hiddenBandIdInput = document.createElement("input");
				hiddenBandIdInput.type = "hidden";
				hiddenBandIdInput.name = "bandId";

				let bandId = new URLSearchParams(window.location.search).get("band_id");
				if (!bandId) {
					const bandIdEl = document.getElementById("band-id");
					if (bandIdEl) bandId = bandIdEl.textContent.trim();
				}

				hiddenBandIdInput.value = bandId || "";
				form.appendChild(hiddenBandIdInput);

				// íŒì—… ì—´ê¸°
				addAllBtn.addEventListener("click", () => {
					allPopup.style.display = "block";
				});

				// íŒì—… ë‹«ê¸°
				document.getElementById("close-all-popup").addEventListener("click", () => {
					allPopup.style.display = "none";
				});

				// ì €ì¥ ë²„íŠ¼
				document.getElementById("save-all-btn").addEventListener("click", () => {
					const title = document.getElementById("all-photo-title").value.trim();
					const desc = document.getElementById("all-photo-desc").value.trim();
					const youtubeUrl = document.getElementById("all-photo-youtube").value.trim();
					const photoFile = document.getElementById("new-all-photo").files[0];

					if (!title || !desc || !photoFile) {
						alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
						return;
					}

					const formData = new FormData();
					formData.append("title", title);
					formData.append("description", desc);
					formData.append("youtubeUrl", youtubeUrl);
					formData.append("photo", photoFile);
					formData.append("bandId", bandId || "");

					if (csrfToken && csrfParam) {
						formData.append(csrfParam, csrfToken);
					}

					fetch("/bandinsertselect/activeinsert", {
						method: "POST",
						body: formData
					})
						.then(response => {
							if (response.ok) {
								alert("æ´»å‹•å†™çœŸãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚");

								// ìˆ˜ì •ëª¨ë“œ ì¢…ë£Œë¥¼ ìœ„í•´ 'ìˆ˜ì •ì™„ë£Œ' ë²„íŠ¼ í´ë¦­
								document.getElementById("edit-toggle-btn")?.click();

							} else {
								alert("è¿½åŠ å¤±æ•—");
							}
						})
						.catch(error => {
							console.error("è¿½åŠ å¤±æ•—:", error);
							alert("æ´»å‹•å†™çœŸè¿½åŠ ã¡ã£ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
						});
				});
			}
		</script>

		<script>
			// í™œë™ ê¸°ë¡ ì¶”ê°€ (ìˆ˜ì •ëª¨ë“œ ì§„ì… ì‹œ ìƒì„±)
			function initRecordAddButton() {
				const sectionRecords = document.getElementById("section-records");
				if (!sectionRecords || !window.editMode || window.addRecordBtnCreated) return;

				// ë²„íŠ¼ ìƒì„±
				const addRecordBtn = document.createElement("button");
				addRecordBtn.id = "add-record-btn";
				addRecordBtn.type = "button";
				addRecordBtn.textContent = "æ´»å‹•è¨˜éŒ²è¿½åŠ ";
				addRecordBtn.className = "btn-primary edit-only";

				Object.assign(addRecordBtn.style, {
					position: "absolute",
					top: "-40px",
					right: "140px",
					zIndex: "10",
					padding: "10px 20px",
					background: "#000",
					color: "#fff",
					borderRadius: "8px",
					fontSize: "16px",
					border: "none",
					cursor: "pointer",
					marginRight: "20px"
				});

				sectionRecords.style.position = "relative";
				sectionRecords.appendChild(addRecordBtn);
				window.addRecordBtnCreated = true;

				// íŒì—… ìƒì„±
				const popup = document.createElement("div");
				popup.id = "add-record-popup";
				popup.style.cssText = `
					display: none;
					position: fixed;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					background: #fff;
					padding: 30px;
					box-shadow: 0 4px 10px rgba(0,0,0,0.2);
					border-radius: 12px;
					z-index: 1000;
					width: 400px;
					font-family: 'Noto Sans KR', sans-serif;
					color: #000;
					box-sizing: border-box;
				`;

				popup.innerHTML = `
					<h3 style="font-size:22px; font-weight:bold; text-align:center; margin-bottom:25px;">æ´»å‹•è¨˜éŒ²è¿½åŠ </h3>
					<input type="text" id="new-title" placeholder="å…¬æ¼”ã‚¿ã‚¤ãƒˆãƒ«" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
					<input type="date" id="new-date" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
					<input type="time" id="new-time" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
					<input type="text" id="new-location" placeholder="å ´æ‰€" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
					<input type="text" id="new-capacity" placeholder="äººæ•°" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
					<input type="file" id="new-thumb-upload" style="width:100%; padding:12px; font-size:16px; border:1px solid #ccc; border-radius:8px; margin-bottom:20px;">
					<textarea id="new-desc" placeholder="ç°¡å˜ãªèª¬æ˜" style="width:100%; height:100px; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; resize:vertical; margin-bottom:10px;"></textarea>
					<div style="display:flex; justify-content:center; align-items:center; gap:10px;">
						<button id="save-new-record-btn" class="btn-primary" style="background:#000; color:#fff; padding:12px 24px; font-size:15px; border:none; border-radius:8px; cursor:pointer;">ä¿å­˜ã™ã‚‹</button>
						<button id="close-new-record-popup" class="btn-primary" style="background:#fff; color:#000; border:1px solid #000; padding:12px 24px; font-size:15px; border-radius:8px; cursor:pointer;">é–‰ã‚ã‚‹</button>
					</div>
				`;

				document.body.appendChild(popup);

				// ì—´ê¸°
				addRecordBtn.addEventListener("click", () => {
					popup.style.display = "block";
				});

				// ë‹«ê¸°
				document.getElementById("close-new-record-popup").addEventListener("click", () => {
					popup.style.display = "none";
				});

				// ì €ì¥ ì²˜ë¦¬
				document.getElementById("save-new-record-btn").addEventListener("click", () => {
					const title = document.getElementById("new-title").value.trim();
					const date = document.getElementById("new-date").value.trim();
					const time = document.getElementById("new-time").value.trim();
					const location = document.getElementById("new-location").value.trim();
					const capacity = document.getElementById("new-capacity").value.trim();
					const desc = document.getElementById("new-desc").value.trim();
					const imageFile = document.getElementById("new-thumb-upload").files[0];

					if (!title || !date || !time || !location || !capacity || !desc || !imageFile) {
						alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
						return;
					}

					const formData = new FormData();
					formData.append("recordTitle", title);
					formData.append("recordDate", date);
					formData.append("recordTime", time);
					formData.append("recordLocation", location);
					formData.append("participantCount", capacity);
					formData.append("recordDescription", desc);
					formData.append("recordImage", imageFile);

					// bandId ì¶”ê°€
					const bandId = document.getElementById("band-id")?.textContent.trim();
					formData.append("bandId", bandId || "");

					// CSRF ì²˜ë¦¬
					const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
					const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
					if (csrfToken && csrfParam) {
						formData.append(csrfParam, csrfToken);
					}

					fetch("/bandinsertselect/recordinsert", {
						method: "POST",
						body: formData
					})
					.then(async response => {
						if (response.ok) {
							alert("æ´»å‹•è¨˜éŒ²ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚");
							document.getElementById("edit-toggle-btn")?.click(); // ìë™ ìˆ˜ì •ì™„ë£Œ
						} else {
							const text = await response.text();
							console.error("âŒ ìƒíƒœ ì½”ë“œ:", response.status);
							console.error("âŒ ì‘ë‹µ ë‚´ìš©:", text);
							alert("ì¶”ê°€ ì‹¤íŒ¨: " + response.status);
						}
					})
					.catch(error => {
						console.error("âŒ ì¶”ê°€ ì‹¤íŒ¨:", error);
						alert("è¿½åŠ ä¸­ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
					});
				});
			}
		</script>

		<script>
		  // í™œë™ ê¸°ë¡ ìˆ˜ì • (ìˆ˜ì •ëª¨ë“œ ì§„ì… ì‹œ ìƒì„±)
		  function initRecordEditButton() {
		    const sectionRecords = document.getElementById("section-records");
		    if (!sectionRecords || window.editRecordBtnCreated) return;
		    window.editRecordBtnCreated = true;
		    sectionRecords.style.position = "relative";

		    const editRecordBtn = document.createElement("button");
		    editRecordBtn.id = "edit-record-btn";
		    editRecordBtn.type = "button";
		    editRecordBtn.textContent = "æ´»å‹•è¨˜éŒ²ç·¨é›†";
		    editRecordBtn.className = "btn-primary edit-only";
		    Object.assign(editRecordBtn.style, {
		      position: "absolute",
		      top: "-40px",
		      right: "20px",
		      zIndex: "10",
		      padding: "10px 20px",
		      background: "#000",
		      color: "#fff",
		      borderRadius: "8px",
		      fontSize: "16px",
		      border: "none",
		      cursor: "pointer"
		    });
		    sectionRecords.appendChild(editRecordBtn);

		    document.querySelectorAll("#section-records .record-card").forEach(card => {
		      const checkbox = document.createElement("input");
		      checkbox.type = "checkbox";
		      checkbox.className = "record-select-checkbox";
		      Object.assign(checkbox.style, {
		        position: "absolute",
		        top: "10px",
		        left: "10px",
		        width: "20px",
		        height: "20px",
		        zIndex: "20"
		      });
		      checkbox.addEventListener("change", () => {
		        if (checkbox.checked) {
		          document.querySelectorAll(".record-select-checkbox").forEach(cb => {
		            if (cb !== checkbox) cb.checked = false;
		          });
		        }
		      });
		      card.style.position = "relative";
		      card.appendChild(checkbox);
		    });

		    const editRecordPopup = document.createElement("div");
		    editRecordPopup.id = "edit-record-popup";
		    editRecordPopup.style.cssText = `
		      display: none;
		      position: fixed;
		      top: 50%;
		      left: 50%;
		      transform: translate(-50%, -50%);
		      background: #fff;
		      padding: 30px;
		      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
		      border-radius: 12px;
		      z-index: 1000;
		      width: 400px;
		      font-family: 'Noto Sans KR', sans-serif;
		      color: #000;
		      box-sizing: border-box;
		    `;
		    editRecordPopup.innerHTML = `
		      <h3 style="font-size:22px; font-weight:bold; text-align:center; margin-bottom:25px;">æ´»å‹•è¨˜éŒ²ç·¨é›†</h3>
			  <img id="edit-thumb-preview" src="" style="width:100%; border-radius:8px; margin-bottom:10px; display:none;" alt="ã‚µãƒ ãƒã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
		      <input type="text" id="edit-title" placeholder="å…¬æ¼”ã‚¿ã‚¤ãƒˆãƒ«" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
		      <input type="date" id="edit-date" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
		      <input type="time" id="edit-time" placeholder="æ™‚é–“" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
		      <input type="text" id="edit-location" placeholder="å ´æ‰€" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
		      <input type="text" id="edit-capacity" placeholder="äººæ•°" style="width:100%; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">
		      <input type="file" id="edit-thumb-upload" style="width:100%; padding:12px; font-size:16px; border:1px solid #ccc; border-radius:8px; margin-bottom:20px;">
		      <textarea id="edit-desc" placeholder="ç°¡å˜ãªèª¬æ˜" style="width:100%; height:100px; padding:20px; font-size:20px; border:1px solid #ccc; border-radius:8px; resize:vertical; margin-bottom:10px;"></textarea>
		      <div style="display:flex; justify-content:center; align-items:center; gap:10px;">
		        <button id="save-edit-btn" class="btn-primary" style="background:#000; color:#fff; padding:12px 24px; font-size:15px; border:none; border-radius:8px; cursor:pointer;">ä¿å­˜ã™ã‚‹</button>
		        <button id="close-edit-popup" class="btn-primary" style="background:#fff; color:#000; border:1px solid #000; padding:12px 24px; font-size:15px; border-radius:8px; cursor:pointer;">é–‰ã‚ã‚‹</button>
		      </div>
		    `;
		    document.body.appendChild(editRecordPopup);

		    editRecordBtn.addEventListener("click", () => {
		      const selected = document.querySelector(".record-select-checkbox:checked");
		      if (!selected) return alert("ç·¨é›†ã™ã‚‹æ´»å‹•è¨˜éŒ²ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");

		      const card = selected.closest(".record-card");
			  
		      const title = card.querySelector(".record-title")?.textContent.trim() || "";
		      const year = new Date().getFullYear();
		      const monthStr = card.querySelector(".record-date span")?.textContent.trim().replace("ì›”", "") || "1";
		      const dayStr = card.querySelector(".record-date strong")?.textContent.trim() || "1";
		      const isoDate = `${year}-${monthStr.padStart(2, '0')}-${dayStr.padStart(2, '0')}`;
		      const time = card.querySelector(".record-meta span:nth-of-type(1)")?.textContent.trim() || "";
		      const capacity = card.querySelector(".record-meta span:nth-of-type(2)")?.textContent.replace("ëª…", "").trim() || "";
		      const desc = card.querySelector(".review-item p")?.textContent.trim() || "";
		      const location = card.querySelector(".record-location")?.textContent.trim() || "";

		      document.getElementById("edit-title").value = title;
		      document.getElementById("edit-date").value = isoDate;
		      document.getElementById("edit-time").value = time;
		      document.getElementById("edit-location").value = location;
		      document.getElementById("edit-capacity").value = capacity;
		      document.getElementById("edit-desc").value = desc;

		      editRecordPopup.style.display = "block";
		    });

		    document.getElementById("close-edit-popup").addEventListener("click", () => {
		      editRecordPopup.style.display = "none";
		    });

		    document.getElementById("save-edit-btn").addEventListener("click", () => {
				const selected = document.querySelector(".record-select-checkbox:checked");
				 const card = selected?.closest(".record-card");
				 const recordId = card?.querySelector(".record-id")?.textContent.trim();
				 if (!recordId) {
				   alert("recordIdê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				   return;
				 }
		      const title = document.getElementById("edit-title").value.trim();
		      const date = document.getElementById("edit-date").value.trim();
		      const time = document.getElementById("edit-time").value.trim();
		      const location = document.getElementById("edit-location").value.trim();
		      const capacity = document.getElementById("edit-capacity").value.trim();
		      const desc = document.getElementById("edit-desc").value.trim();
		      const imageFile = document.getElementById("edit-thumb-upload").files[0];

		      if (!title || !date || !time || !location || !capacity || !desc) {
		        alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
		        return;
		      }

		      const formData = new FormData();
			  formData.append("recordId", recordId);
		      formData.append("recordTitle", title);
		      formData.append("recordDate", date);
		      formData.append("recordTime", time);
		      formData.append("recordLocation", location);
		      formData.append("participantCount", capacity);
		      formData.append("recordDescription", desc);
		      if (imageFile) formData.append("recordImage", imageFile);

		      const bandId = document.getElementById("band-id")?.textContent.trim();
		      if (bandId) formData.append("bandId", bandId);

		      const csrfToken = document.querySelector('meta[name="_csrf"]')?.content;
		      const csrfParam = document.querySelector('meta[name="_csrf_parameter"]')?.content;
		      if (csrfToken && csrfParam) {
		        formData.append(csrfParam, csrfToken);
		      }

		      fetch("/bandinsertselect/recordupdate", {
		        method: "POST",
		        body: formData
		      })
		        .then(response => {
		          if (response.ok) {
		            alert("æ´»å‹•è¨˜éŒ²ã®ç·¨é›†ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚");
		            document.getElementById("edit-toggle-btn")?.click();
		          } else {
		            alert("ìˆ˜ì • ì‹¤íŒ¨");
		          }
		        })
		        .catch(error => {
		          console.error("ìˆ˜ì • ì‹¤íŒ¨:", error);
		          alert("ç·¨é›†ä¸­ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
		        });
		    });
		  }

		</script>


		<!-- ì„¸ ë²ˆì§¸: ìˆ˜ì •ëª¨ë“œ í˜ì´ì§• ê¸°ëŠ¥ (ë°´ë“œì†Œê°œ í˜ì´ì§•) -->
		<script>
			// ë°´ë“œì†Œê°œ í˜ì´ì§• ê¸°ëŠ¥ (ìˆ˜ì •ëª¨ë“œ ì§„ì… ì‹œ ì‹¤í–‰)
			function initBandIntroPaging() {

				const introItems = document.querySelectorAll("#section-intro .intro-list li");
				if (introItems.length < 4) return; // liê°€ ìµœì†Œ 4ê°œ ìˆì–´ì•¼ ì •ìƒ

				const introPages = [
					[introItems[0], introItems[1]], // 1í˜ì´ì§€: ê²°ì„±ì¼ + ì¥ë¥´
					[introItems[2], introItems[3]]  // 2í˜ì´ì§€: í™œë™ì§€ì—­ + ë°´ë“œì†Œê°œ
				];
				let introIndex = 0;

				function updateIntroPage(newIndex) {
					introPages[introIndex].forEach(el => el.style.display = "none");
					introIndex = newIndex;
					introPages[introIndex].forEach(el => el.style.display = "block");
				}

				// ì²˜ìŒì— ì „ë¶€ ìˆ¨ê¸°ê³  1í˜ì´ì§€ë§Œ ë³´ì—¬ì¤Œ
				introItems.forEach(el => el.style.display = "none");
				updateIntroPage(0);

				// í˜ì´ì§• ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ìƒì„±
				if (!document.getElementById("intro-paging-controls")) {
					const pagingWrap = document.createElement("div");
					pagingWrap.id = "intro-paging-controls";
					pagingWrap.style.display = "flex";
					pagingWrap.style.justifyContent = "center";
					pagingWrap.style.gap = "20px";
					pagingWrap.style.marginTop = "20px";

					pagingWrap.innerHTML = `
      <button id="intro-prev-btn" class="btn-primary">â—€</button>
      <button id="intro-next-btn" class="btn-primary">â–¶</button>
    `;

					const target = document.querySelector("#section-intro .intro-list");
					if (target?.parentNode) {
						target.parentNode.insertBefore(pagingWrap, target.nextSibling);
					}

					document.getElementById("intro-prev-btn").addEventListener("click", () => {
						if (introIndex > 0) {
							updateIntroPage(introIndex - 1);
						}
					});

					document.getElementById("intro-next-btn").addEventListener("click", () => {
						if (introIndex < introPages.length - 1) {
							updateIntroPage(introIndex + 1);
						}
					});
				}
			}
		</script>

		<script>
			// ìˆ˜ì •ëª¨ë“œ í† ê¸€ ë²„íŠ¼ ê¸°ëŠ¥ ì´ˆê¸°í™”
			function initEditToggle() {
				const editButton = document.getElementById("edit-toggle-btn");
				if (!editButton) return;

				const storedMode = sessionStorage.getItem("editMode") === "true";
				window.editMode = storedMode;

				// ì´ë©”ì¼ í‘œì‹œ ì—¬ë¶€ ì²˜ë¦¬
				const emailEl = document.getElementById("leader-email");
				if (emailEl) {
					emailEl.style.display = storedMode ? "none" : "block";
				}

				if (storedMode) {
					editButton.textContent = "ìˆ˜ì •ì™„ë£Œ";
					initCoverImageEdit();
					initProfileEdit();
					initBandIntro();
					initBandIntroPaging();
					initGalleryEditButton();
					initGalleryAddButton();
					initRecordEditButton();
					initRecordAddButton();
					initMemberPopupEdit();
				} else {
					removeEditButtons();
				}

				editButton.addEventListener("click", () => {
					window.editMode = !window.editMode;
					sessionStorage.setItem("editMode", window.editMode ? "true" : "false");
					editButton.textContent = window.editMode ? "ç·¨é›†å®Œäº†" : "ç·¨é›†ã™ã‚‹";

					// ì´ë©”ì¼ í‘œì‹œ ì—¬ë¶€ ë‹¤ì‹œ ì²˜ë¦¬
					if (emailEl) {
						emailEl.style.display = window.editMode ? "none" : "block";
					}

					if (window.editMode) {
						initCoverImageEdit();
						initProfileEdit();
						initBandIntro();
						initBandIntroPaging();
						initGalleryEditButton();
						initGalleryAddButton();
						initRecordEditButton();
						initRecordAddButton();
						initMemberPopupEdit();
					} else {
						sessionStorage.setItem("forceReload", "true");
						location.reload();
					}
				});
			}
		</script>

		<script>
			// í”„ë¡œí•„ ì˜ì—­ ì›ìƒë³µêµ¬ (ì´ë¦„/í•¸ë“¤/í•œì¤„ì†Œê°œ)
			function restoreProfileInfo() {
				const fields = [
					{selector: ".band-name", defaultText: "Tomo Groove"},
					{selector: ".band-handle", defaultText: "@tomogroove"},
					{selector: ".band-one-liner", defaultText: "ë„ì¿„ì™€ í™ëŒ€ë¥¼ ì˜¤ê°€ëŠ” ê°ì„± ì‹œí‹°íŒ ë°´ë“œì…ë‹ˆë‹¤ ğŸ·"}
				];

				fields.forEach(({selector, defaultText}) => {
					const container = document.querySelector(selector);
					if (!container) return;

					const input = container.querySelector("input");
					if (input) {
						const value = input.value.trim();
						container.textContent = value || defaultText;
					}
				});
			}
		</script>

		<script>
			// ë°´ë“œ ì†Œê°œ ì˜ì—­ ì›ìƒë³µêµ¬ (+ í˜ì´ì§• ì œê±° í¬í•¨)
			function restoreBandIntro() {
				const introList = document.querySelectorAll("#section-intro .intro-list li");

				introList.forEach(li => {
					const label = li.querySelector("strong")?.textContent.trim();
					if (!label) return;

					const input = li.querySelector("input");
					const value = input ? input.value.trim() : "";

					if (label.includes("ê²°ì„±ì¼")) {
						li.innerHTML = `<strong>${label}</strong> ${value || "2022ë…„ 5ì›”"}`;
					} else if (label.includes("ì¥ë¥´")) {
						li.innerHTML = `<strong>${label}</strong> ${value || "ì‹œí‹°íŒ, ì¬ì¦ˆ, ì¸ë””"}`;
					} else if (label.includes("í™œë™ì§€ì—­")) {
						li.innerHTML = `<strong>${label}</strong> ${value || "ì„œìš¸ í™ëŒ€, ë„ì¿„ ì‹œë¶€ì•¼"}`;
					} else if (label.includes("ë°´ë“œ ì†Œê°œ")) {
						const textarea = li.querySelector("textarea");
						const text = textarea ? textarea.value.trim() : "";
						li.innerHTML = `<strong>${label}</strong><p class="band-description">${text || "Tomo GrooveëŠ” ë„ì¿„ì™€ í™ëŒ€ ì¤‘ì‹¬ìœ¼ë¡œ í™œë™í•˜ëŠ” ë°´ë“œì…ë‹ˆë‹¤."}</p>`;
					}

					// ê° í•­ëª© display:block ìœ¼ë¡œ ëª¨ë‘ í‘œì‹œ
					li.style.display = "list-item";
				});

				// í˜ì´ì§• ì»¨íŠ¸ë¡¤ ì œê±°
				const paging = document.getElementById("intro-paging-controls");
				if (paging) paging.remove();
			}
		</script>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				if (window.editMode) {
					initProfileEdit();
					initBandIntro();
					initBandIntroPaging();
					initGalleryEditButton();
					initGalleryAddButton();
					initRecordEditButton();
					initRecordAddButton();
					initMemberPopupEdit();
				} else {
					removeEditButtons(); // ë¹„ë¦¬ë”ì¼ ê²½ìš° ì•ˆì „í•˜ê²Œ ì´ˆê¸°í™”
				}
			});
		</script>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const gallerySection = document.getElementById("section-gallery");
				const galleryWrapper = gallerySection.querySelector(".gallery-wrapper");
				const galleryEmptyMessage = galleryWrapper.querySelector("p");

				const realSlides = galleryWrapper.querySelectorAll(".media-slide");
				const arrows = galleryWrapper.querySelectorAll(".gallery-arrow");
				const dots = galleryWrapper.querySelector(".gallery-dots");

				// ìŠ¬ë¼ì´ë“œê°€ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ìˆ¨ê¸°ì§€ ì•ŠìŒ
				if (
					galleryEmptyMessage &&
					galleryEmptyMessage.textContent.includes("ç™»éŒ²ã•ã‚ŒãŸæ´»å‹•å†™çœŸãŒã‚ã‚Šã¾ã›ã‚“ã€‚") &&
					realSlides.length === 0
				) {
					arrows.forEach(arrow => arrow.style.display = "none");
					if (dots) dots.style.display = "none";
				}
			});

		</script>


		<script>
			// ìˆ˜ì •ëª¨ë“œ í•´ì œ ì‹œ ìƒì„±ëœ ìˆ˜ì • ë²„íŠ¼ë“¤ ì œê±°
			function removeEditButtons() {
				const elementIds = [
					"edit-gallery-btn",
					"add-all-btn",
					"edit-record-btn",
					"add-record-btn",
					"profile-file-btn",
					"intro-paging-controls"
				];

				elementIds.forEach(id => {
					const el = document.getElementById(id);
					if (el && el.parentNode) {
						el.parentNode.removeChild(el);
					}
				});

				// ìƒíƒœ ë³€ìˆ˜ ì´ˆê¸°í™”
				window.editGalleryBtnCreated = false;
				window.addAllBtnCreated = false;
				window.editRecordBtnCreated = false;
				window.addRecordBtnCreated = false;
				window.profileEditBtnCreated = false;
			}

		</script>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
			  const emailEl = document.getElementById("leader-email");
			  if (!emailEl) return;

			  const justExited = sessionStorage.getItem("justExitedEditMode") === "true";
			  const editMode = sessionStorage.getItem("editMode") === "true";

			  if (editMode) {
			    // ìˆ˜ì •ëª¨ë“œ ì¤‘ì´ë©´ ë¬´ì¡°ê±´ ìˆ¨ê¹€
			    emailEl.style.display = "none";
			  } else if (justExited) {
			    // ì €ì¥ í›„ ìƒˆë¡œê³ ì¹¨ëœ ê²½ìš° â†’ ë”œë ˆì´ í›„ í‘œì‹œ
			    emailEl.style.display = "none";
			    setTimeout(() => {
			      emailEl.style.display = "block";
			      sessionStorage.removeItem("justExitedEditMode");
			    }, 300); // 300ms ì •ë„ ë”œë ˆì´
			  } else {
			    // í‰ìƒì‹œì—ëŠ” ë°”ë¡œ ë³´ì´ë„ë¡
			    emailEl.style.display = "block";
			  }
			});

		</script>
			
		<script>
		  window.addEventListener("load", () => {
		    const emailEl = document.getElementById("leader-email");
		    if (!emailEl) return;

		    const justExited = sessionStorage.getItem("justExitedEditMode") === "true";
		    const editMode = sessionStorage.getItem("editMode") === "true";

		    if (!editMode && justExited) {
		      emailEl.classList.add("visible"); // ëª¨ë“  ë¦¬ì†ŒìŠ¤ ë¡œë“œ í›„ í‘œì‹œ
		      sessionStorage.removeItem("justExitedEditMode");
		    }
		  });
		</script>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				initEditToggle(); // ìˆ˜ì •í•˜ê¸° ë²„íŠ¼ ê¸°ëŠ¥ ì—°ê²°
			});
		</script>
		
		
		
		<script th:inline="javascript">
		/*<![CDATA[*/
		  const band_id      = [[${band.band_id}]];
		  const currentUser = [[${currentUserVo?.user_id}]];
		/*]]>*/
		</script>
		<script>
		const popup = document.getElementById('member-invite-popup');
		if(popup){
			
		    popup.style.display = "block";

			
			document.getElementById('btn-accept').addEventListener('click', () => {
				fetch(`/bandinvite/${band_id}/invite/${currentUser}/accept`, {
					method: 'POST',
					headers: { [csrfHeader]: csrfToken }
				})
				.then(res => {
					if (!res.ok) throw new Error('ìˆ˜ë½ ì‹¤íŒ¨');
					popup.style.display = 'none';
					alert('æ‹›å¾…ã‚’å—ã‘å…¥ã‚Œã¾ã—ãŸ')
				})
				.catch(err => {
					console.error(err);
					alert('ìˆ˜ë½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ')
				})
			})
			document.getElementById('btn-decline').addEventListener('click', () => {
				fetch(`/bandinvite/${band_id}/invite/${currentUser}/decline`, {
					method: 'POST',
					headers: { [csrfHeader]: csrfToken }
				})
				.then(res => {
					if (!res.ok) throw new Error('ê±°ì ˆ ì‹¤íŒ¨');
					popup.style.display = 'none';
					alert('æ‹›å¾…ã‚’æ‹’å¦ã—ã¾ã—ãŸ')
				})
				.catch(err => {
					console.error(err);
					alert('ê±°ì ˆ ì¤‘ ì˜¤ë¥˜ ë°œìƒ')
				})
			})
		}
		</script>


		
	</div>
</body>

</html>