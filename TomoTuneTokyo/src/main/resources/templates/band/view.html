<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultrag.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<head>
	<meta charset="UTF-8">
	<title>å‹Ÿé›†å†…å®¹</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
	<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>

<body>
<div layout:fragment="content">
	<!-- ê²Œì‹œê¸€ ìƒë‹¨: íŒ€ ì†Œê°œ + ìƒì„¸ë³´ê¸° ì„¸íŠ¸ -->
	<div class="band-and-detail-container"> <!-- ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ì„ í•˜ë‚˜ì˜ divë¡œ ë¬¶ìŒ -->
		<!-- ê²Œì‹œê¸€ ìƒë‹¨: íŒ€ ì†Œê°œ + ìƒì„¸ë³´ê¸° ì„¸íŠ¸ -->
<input type="hidden" th:value="${postId}" name="postId"> <!-- ìƒë‹¨ì— hidden í•„ë“œë¡œ postId ì „ë‹¬ -->

<div class="detail-container">
<div class="band-info-container">
	<!-- ì™¼ìª½: ë¦¬ë” + ë©¤ë²„ + ì½”ë©˜íŠ¸ -->
	<!-- ë§ˆê°ì¼ -->
	<div class="deadline-badge">
	    <span class="deadline-text" id="dDayText">D-?</span>
	</div>
	<input type="hidden" id="deadline" th:value="${post.deadline}" />

<div class="band-profile-area" style="position: relative;">
	<!-- íŒ€ ì†Œê°œ: ì™¼ìª½ ì˜ì—­ -->
	<div class="band-title">
	    <span class="emoji">â˜€ï¸</span> <strong th:text="${band_name}"></strong>
	</div>

	<!-- ë¦¬ë” ì •ë³´ -->
<div class="band-leader">
	<div class="leader-pic">
		<img th:if="${leaderInfo != null and leaderInfo.user_img != null and !#strings.isEmpty(leaderInfo.user_img)}"
			th:src="@{'/upload/' + ${leaderInfo.user_img}}" class="member-image-preview mb-2"
			style="width:60px; height:60px; border-radius:50%; object-fit:cover;" alt="í”„ë¡œí•„">

		<!-- ë¦¬ë” ì´ë¯¸ì§€: ê°’ì´ ì—†ê±°ë‚˜ leaderInfo ìì²´ê°€ nullì¼ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ í‘œì‹œ -->
		<img th:if="${leaderInfo == null or leaderInfo.user_img == null or #strings.isEmpty(leaderInfo.user_img)}"
			th:src="@{/images/member1.png}" class="member-image-preview mb-2"
			style="width:60px; height:60px; border-radius:50%; object-fit:cover;" alt="ê¸°ë³¸">
	</div>
	<div class="leader-name" th:text="'ãƒªãƒ¼ãƒ€ãƒ¼ãƒ»' + ${leader.stage_name}">ë¦¬ë”ãƒ»ã‚¬ãƒ </div>
	<div id="profile-popup" style="display: none; position: absolute; top: 50px; left: 0; z-index: 9999; overflow: visible;">
	
		  <!-- Swiper ìŠ¬ë¼ì´ë” -->
		<!-- íŒì—…ì°½-->
    <div class="swiper profile-swiper">
		<button type="button" id="closeProfilePopup"
			        style="position: absolute; top: 10px; right: 30px; background: transparent; border: none; font-size: 20px; cursor: pointer; z-index: 20; color: black;">Ã—</button>

        <div class="swiper-wrapper">
			<!-- í™œë™ ì‚¬ì§„ 1 -->
			<div class="swiper-slide"
			     th:if="${post.image1Url != null and !#strings.isEmpty(post.image1Url)}">
			    <img th:src="@{'/images/uploads/bands/' + ${post.image1Url}}" alt="í™œë™ ì‚¬ì§„ 1">
			</div>

			<!-- í™œë™ ì‚¬ì§„ 2 -->
			<div class="swiper-slide"
			     th:if="${post.image2Url != null and !#strings.isEmpty(post.image2Url)}">
			    <img th:src="@{'/images/uploads/bands/' + ${post.image2Url}}" alt="í™œë™ ì‚¬ì§„ 2">
			</div>

			<!-- í™œë™ ì‚¬ì§„ 3 -->
			<div class="swiper-slide"
			     th:if="${post.image3Url != null and !#strings.isEmpty(post.image3Url)}">
			    <img th:src="@{'/images/uploads/bands/' + ${post.image3Url}}" alt="í™œë™ ì‚¬ì§„ 3">
			</div>

			<!-- í™œë™ ì‚¬ì§„ 4 -->
			<div class="swiper-slide"
			     th:if="${post.image4Url != null and !#strings.isEmpty(post.image4Url)}">
			    <img th:src="@{'/images/uploads/bands/' + ${post.image4Url}}" alt="í™œë™ ì‚¬ì§„ 4">
			</div>
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>
</div>
</div>

<!-- ë©¤ë²„ë“¤ -->
<div class="band-members">
	<div class="member" th:each="member : ${members}">
		<img th:src="@{${member.user_img != null ? '/upload/' + member.user_img : '/images/default.png'}}"
			src="/images/default.png" alt="ë©¤ë²„ í”„ë¡œí•„" class="profile-image" data-index="1">
		<span th:text="${member.stage_name}"></span>
	</div>
</div>

<!-- ë¦¬ë” ì½”ë©˜íŠ¸ -->
<div class="band-comment-area">
	<h3>ãƒªãƒ¼ãƒ€ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
	<p th:text="${post.leaderComment}"></p>
</div>
<!-- í•´ì‹œíƒœê·¸-->
<div class="tag-black-container">
    <span class="tag-black" th:each="tag : ${recommendedTags}" th:text="${tag}"></span>
</div>

</div>
</div>

<!-- ì˜¤ë¥¸ìª½: êµ¬ì¸/êµ¬ì§ ê¸€ -->
<form class="post-detail-form">
	<!-- ìˆ˜ì • ë²„íŠ¼: ë¦¬ë”ì—ê²Œë§Œ ë³´ì„ -->
	<div th:if="${isLeader}" class="edit-button-container">
		<button type="button" class="btn btn-warning btn-edit" id="editBandBtn">âœï¸ ä¿®æ­£ã™ã‚‹</button>
	</div>

    <div class="title-and-button">
        <h2 class="detail-title" th:text="${post.title}"></h2>
        <button type="button" class="apply-btn-absolute" data-target="#applyModal" id="openApplyModal">å¿œå‹Ÿã™ã‚‹</button>
    </div>
    <div class="detail-meta">
        <span>ä½œæˆè€…: <span th:text="${leader.stage_name}">ã‚¬ãƒ </span></span> <!-- ë¦¬ë” ì´ë¦„ -->
        <span>ä½œæˆæ—¥: <span th:text="${#dates.format(post.createdAt, 'yyyy.MM.dd')}">2024.05.12</span></span> <!-- ìƒì„±ì¼ -->
        <span>ãƒ’ãƒƒãƒˆæ•°: <span th:text="${post.bandrecruitpost_count}"></span></span> <!-- ì¡°íšŒìˆ˜ -->
    </div>

    <div class="detail-content">
        <h3>ğŸ¤ ãƒãƒ³ãƒ‰ã®ç´¹ä»‹</h3>
        <p th:text="${post.band_intro}"></p>
        <h3>ğŸ¯ å‹Ÿé›†ãƒã‚¸ã‚·ãƒ§ãƒ³</h3>
        <p th:text="${post.recruitPosition}"></p>
        <h3>ğŸŒ æ´»å‹•åœ°åŸŸ</h3>
        <p th:text="${post.activityArea}"></p>
        <h3>ğŸ“¯ ã“ã‚“ãªäººã‚’æ¢ã—ã¦ã„ã¾ã™ï¼</h3>
        <p><strong th:text="${post.recruitCondition}"></strong></p>
        <h3>ğŸµ å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«</h3>
        <p th:text="${post.preferredGenres}"></p>
		    </div>
		</form>
	</div>
</div>
<!-- ì§€ì›í•˜ê¸° ëª¨ë‹¬ -->
<div class="modal fade" id="applyModal" tabindex="-1" role="dialog" aria-labelledby="applyModalLabel">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">

			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="applyModalLabel">å‹Ÿé›†å†…å®¹ã®ä½œæˆ</h4>
			</div>

			<div class="modal-body">
				<form id="applyForm" enctype="multipart/form-data">

					<!-- ë°´ë“œíŒ€ëª… -->
							<div class="form-group">
								<label for="bandName">ãƒãƒ³ãƒ‰ã®ãƒãƒ¼ãƒ å</label> <input type="text" class="form-control"
									id="bandName" placeholder="Tomato Groove">
							</div>

							<!-- ë°´ë“œì†Œê°œ -->
							<div class="form-group">
								<label for="bandIntro">ãƒãƒ³ãƒ‰ç´¹ä»‹</label>
								<textarea class="form-control" id="bandIntro" rows="2"
									placeholder="ãƒãƒ³ãƒ‰ã®ã”ç´¹ä»‹ã‚’ãŠãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"></textarea>
							</div>

							<!-- ëª¨ì§‘í¬ì§€ì…˜ -->
							<div class="form-group">
								<label for="recruitPosition">å‹Ÿé›†ãƒã‚¸ã‚·ãƒ§ãƒ³</label> <input type="text" class="form-control"
									id="recruitPosition" placeholder="ä¾‹ï¼›å¥³æ€§ãƒœãƒ¼ã‚«ãƒ«">
							</div>

							<!-- í™œë™ì§€ì—­ -->
							<div class="form-group">
								<label for="activityArea">æ´»å‹•åœ°åŸŸ</label> <input type="text" class="form-control"
									id="activityArea" placeholder="ä¾‹ï¼›ã‚½ã‚¦ãƒ«å¼˜å¤§">
							</div>

							<!-- ëª¨ì§‘ì¡°ê±´ -->
							<div class="form-group">
								<label for="recruitCondition">ã“ã‚“ãªäººã‚’æ¢ã—ã¦ã„ã¾ã™ï¼</label> <input type="text"
									class="form-control" id="recruitCondition"
									placeholder="ä¾‹: 20ä»£ã€ ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é‡è¦–ã€åŸºæœ¬çš„ãªãƒœãƒ¼ã‚«ãƒ«çµŒé¨“ã‚ã‚Š">
							</div>

							<!-- ì„ í˜¸ ì¥ë¥´ -->
							<div class="form-group">
								<label for="preferredGenres">å¥½ããªã‚¸ãƒ£ãƒ«</label> <input type="text" class="form-control"
									id="preferredGenres" placeholder="ä¾‹: ã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã€ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼ã‚ºã€ãƒãƒƒãƒ—">
							</div>

							<!-- ë¦¬ë”ì˜ ì½”ë©˜íŠ¸ -->
							<div class="form-group">
								<label for="leaderComment">ãƒªãƒ¼ãƒ€ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆ</label>
								<textarea class="form-control" id="leaderComment" rows="2"
									placeholder="ãƒªãƒ¼ãƒ€ãƒ¼ã®ç°¡å˜ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€€:)"></textarea>
							</div>
							<!-- ì¶”ì²œ íƒœê·¸ -->
							<div class="form-group">
								<label for="tags">ãŠã™ã™ã‚ã‚¿ã‚°</label> <input type="text" class="form-control" id="tags"
									placeholder="#ã‚®ã‚¿ãƒ¼ #ãƒœãƒ¼ã‚«ãƒ« #ã‚¸ãƒ£ã‚º">
							</div>

							<!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
							<div class="form-group">
								<label for="bandImages">ãƒãƒ¼ãƒ æ§‹é€ /æ´»å‹•å†™çœŸ</label> <input type="file" id="bandImages"
									name="bandImages" class="form-control" accept="image/*" multiple> <small
									class="text-muted">â€»
									æœ€å¤§ï¼”æšã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒç™»éŒ²å¯èƒ½ã§ã™ã€‚</small>
							</div>
						</form>
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-primary" id="submitApply">å¿œå‹Ÿã™ã‚‹</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">é–‰ã‚ã‚‹</button>
					</div>
				</div>
			</div>
		</div>
	<!-- comment-form-container ë -->
	<!-- ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
		    const leaderPic = document.querySelector('.leader-pic');
		    const profilePopup = document.querySelector('#profile-popup');
		    const closeBtn = document.getElementById('closeProfilePopup');

		    let isHovered = false;
		    let isMouseOverPopup = false;
		    let swiperInstance = null;

		    leaderPic.addEventListener('mouseenter', function () {
		        if (!isHovered) {
		            isHovered = true;
		            profilePopup.style.display = 'block';
		            profilePopup.style.visibility = 'visible';
		            profilePopup.style.opacity = 1;

		            if (!swiperInstance) {
		                swiperInstance = new Swiper('.profile-swiper', {
		                    navigation: {
		                        nextEl: '.swiper-button-next',
		                        prevEl: '.swiper-button-prev',
		                    },
		                    loop: true,
		                });
		            }
		        }
		    });

		    leaderPic.addEventListener('mouseleave', function () {
		        setTimeout(() => {
		            if (!leaderPic.matches(':hover') && !isMouseOverPopup) {
		                isHovered = false;
		                profilePopup.style.display = 'none';
		                profilePopup.style.visibility = 'hidden';
		                profilePopup.style.opacity = 0;
		            }
		        }, 200);
		    });

		    profilePopup.addEventListener('mouseenter', function () {
		        isMouseOverPopup = true;
		    });

		    profilePopup.addEventListener('mouseleave', function () {
		        isMouseOverPopup = false;
		    });

		    // âœ… ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ë„ DOMContentLoaded ì•ˆì—ì„œ ë“±ë¡
		    if (closeBtn) {
		        closeBtn.addEventListener('click', function () {
		            profilePopup.style.display = 'none';
		            profilePopup.style.visibility = 'hidden';
		            profilePopup.style.opacity = 0;
		            isHovered = false;
		            isMouseOverPopup = false;
		        });
		    }
		});


	</script>

	<script>
	    document.addEventListener('DOMContentLoaded', function () {
	        const deadlineValue = document.getElementById('deadline').value;
	        const dDayText = document.getElementById('dDayText');

	        if (deadlineValue) {
	            const today = new Date();
	            const deadline = new Date(deadlineValue);
	            deadline.setHours(0, 0, 0, 0);
	            today.setHours(0, 0, 0, 0);

	            const diffTime = deadline - today;
	            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

	            if (diffDays > 0) {
	                dDayText.textContent = `D-${diffDays}`;
	            } else if (diffDays === 0) {
	                dDayText.textContent = `D-Day`;
	            } else {
	                dDayText.textContent = `ç· åˆ‡`; // ë§ˆê°ë¨
	            }
	        }
	    });
	</script>

	</div>
</body>

</html>